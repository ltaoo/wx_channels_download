(function($,g){typeof exports=="object"&&typeof module<"u"?module.exports=g():typeof define=="function"&&define.amd?define(g):($=typeof globalThis<"u"?globalThis:$||self,$.WUI=g())})(this,(function(){"use strict";function $(y){return Array.isArray(y)?y:y&&Array.isArray(y.children)?y.children:y&&Array.isArray(y.menus)?y.menus:[]}function g(y={}){const{children:T=[],menus:t=null,onMouseLeave:a=null,template:D=null}=y,c={children:Array.isArray(T)?T:Array.isArray(t)?t:[],isOpen:!1,isHover:!1,template:D||g._DEFAULT_TEMPLATE||null,show(){c.isOpen=!0,c.__ref&&c.__ref.open&&c.__ref.open()},hide(){c.isOpen=!1,c.__ref&&c.__ref.close&&c.__ref.close()},setChildren(N){c.children=$(N),c.__ref&&c.__ref.listEl&&(c.__ref.listEl.innerHTML=""),c.__ref&&typeof c.__ref.renderItemsTo=="function"&&c.__ref.listEl?c.__ref.renderItemsTo(c.__ref.listEl,c.children):typeof c.refresh=="function"&&c.refresh()},onMouseLeave:a,ui:{$submenu:null},__ref:null};return c}g._DEFAULT_TEMPLATE=null,g.setTemplate=function(T){g._DEFAULT_TEMPLATE=T},g.getTemplate=function(){return g._DEFAULT_TEMPLATE};let ie=null,ue=null;function h(y={}){const{label:T="",disabled:t=!1,onClick:a=null,onMouseEnter:D=null,onMouseLeave:c=null,children:N=null,submenu:j=null,menus:P=null,template:A=null,indicatorTemplate:W=null}=y;return{label:T,disabled:t,onClick:a,onMouseEnter:D,onMouseLeave:c,children:Array.isArray(N)?N:Array.isArray(P)?P:null,submenu:j||null,isHover:!1,ui:{},template:A??ie,indicatorTemplate:W??ue}}h.setTemplate=function(T){ie=T},h.getTemplate=function(){return ie},h.setIndicatorTemplate=function(T){ue=T},h.getIndicatorTemplate=function(){return ue};const{computePosition:pe,offset:me,flip:ye,shift:ve,autoUpdate:ae,arrow:Me}=window.FloatingUIDOM;function Ce(y,T={}){let t=y,a=T;t&&t.$trigger&&(a=t,t=t.$trigger);const{placement:D="bottom-start",closeOnClickOutside:c=!0,closeOnSelect:N=!1,hoverOpenDelay:j=80,hoverCloseDelay:P=120,showArrow:A=!1,onClose:W=null,manual:S=!0,zIndex:de=1e3}=a,J=Number(de)||1e3,V=a&&a.template!=null?a.template:typeof g.getTemplate=="function"?g.getTemplate():null;let o,s;V?(o=B(V,a)||document.createElement("div"),s=o.querySelector('[data-menu-list="1"]')||o.querySelector(".weui-dropdown-list"),s||(s=document.createElement("div"),s.className="weui-dropdown-list",o.appendChild(s)),o.style.position="fixed",o.style.zIndex=String(J),o.style.display="none"):(o=document.createElement("div"),o.className="weui-dropdown",o.style.position="fixed",o.style.zIndex=String(J),o.style.display="none",o.style.minWidth="160px",o.style.background="var(--weui-dropdown-bg)",o.style.borderRadius="12px",o.style.boxShadow="var(--weui-dropdown-shadow)",o.style.border="0",o.style.padding="8px 0",s=document.createElement("div"),s.className="weui-dropdown-list",o.appendChild(s));const v=document.createElement("div");v.className="weui-dropdown-arrow",v.style.position="absolute",v.style.width="10px",v.style.height="10px",v.style.background="var(--weui-dropdown-bg)",v.style.borderLeft="0",v.style.borderTop="0",v.style.transform="rotate(45deg)",v.style.pointerEvents="none",v.style.display=A?"block":"none",o.appendChild(v);const L=[];function q(){L.forEach(n=>{n.close(),n.el.remove()}),L.length=0}function I(){L.forEach(n=>n.close())}function R(n,l,e){if(typeof n=="function"){const d=n(l);if(d instanceof Node)return d;if(typeof d=="string"){const i=document.createElement("div");let f=d.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));const b=l&&l.indicatorTemplate!=null?l.indicatorTemplate:h&&typeof h.getIndicatorTemplate=="function"?h.getIndicatorTemplate():null;return b&&e&&/\{\{\s*indicator\s*\}\}/.test(f)&&(typeof b=="string"?f=f.replace(/\{\{\s*indicator\s*\}\}/g,b):f=f.replace(/\{\{\s*indicator\s*\}\}/g,"")),i.innerHTML=f,i.firstElementChild||i}return null}if(n instanceof Node)return n;if(typeof n=="string"){const d=document.createElement("div");let i=n.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));const f=l&&l.indicatorTemplate!=null?l.indicatorTemplate:h&&typeof h.getIndicatorTemplate=="function"?h.getIndicatorTemplate():null;return f&&e&&/\{\{\s*indicator\s*\}\}/.test(i)&&(typeof f=="string"?i=i.replace(/\{\{\s*indicator\s*\}\}/g,f):i=i.replace(/\{\{\s*indicator\s*\}\}/g,"")),d.innerHTML=i,d.firstElementChild||d}return null}function B(n,l){const e=()=>'<div class="weui-dropdown-list" data-menu-list="1"></div>';if(typeof n=="function"){const d=n(l);if(d instanceof Node)return d;if(typeof d=="string"){const i=document.createElement("div");let f=d.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));return f=f.replace(/\{\{\s*list\s*\}\}/g,e()),i.innerHTML=f,i.firstElementChild||i}return null}if(n instanceof Node)return n;if(typeof n=="string"){const d=document.createElement("div");let i=n.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));return i=i.replace(/\{\{\s*list\s*\}\}/g,e()),d.innerHTML=i,d.firstElementChild||d}return null}function C(n,l){n.innerHTML="",l.forEach((e,d)=>{const i=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:null;let f=Array.isArray(i)&&i.length>0;const b=!!(e&&e.template!=null);let r;b?r=R(e.template,e,f)||document.createElement("div"):(r=document.createElement("button"),r.type="button",r.className="weui-dropdown-item",r.textContent=e.label,r.style.display="block",r.style.width="100%",r.style.textAlign="left",r.style.padding="12px 16px",r.style.fontSize="15px",r.style.color="var(--weui-dropdown-fg)",r.style.background="transparent",r.style.border="0",r.style.cursor="pointer",r.style.outline="none"),r.dataset.index=String(d),r.dataset.menuItem="1",!b&&e.disabled&&(r.disabled=!0,r.style.opacity="0.5",r.style.cursor="not-allowed"),e.disabled?(r.setAttribute("aria-disabled","true"),b&&(r.tabIndex=-1)):b&&!(r instanceof HTMLButtonElement)&&!(r instanceof HTMLAnchorElement)&&(r.tabIndex=0,r.setAttribute("role","menuitem")),r.addEventListener("mouseenter",()=>{b||(r.style.background="var(--weui-dropdown-hover-bg)"),e.onMouseEnter&&e.onMouseEnter(),e&&(e.isHover=!0)}),r.addEventListener("mouseleave",H=>{b||(r.style.background="transparent"),setTimeout(()=>{e&&(e.isHover=!1),e.onMouseLeave&&e.onMouseLeave(H);const te=e&&e.submenu&&e.submenu.ui&&e.submenu.ui.$submenu;te&&H&&H.relatedTarget&&te.contains(H.relatedTarget)?e.submenu.isHover=!0:e&&e.submenu&&(e.submenu.isHover=!1)},100)});let G=null;if(f){let fe=function(){oe&&(clearTimeout(oe),oe=null),le&&(clearTimeout(le),le=null)},Te=function(){const p=r.closest(".weui-dropdown")||r.closest(".custom-menu")||o,_=p&&parseFloat(window.getComputedStyle(p).paddingRight)||0;pe(r,u,{placement:"right-start",strategy:"fixed",middleware:[me(()=>8+_),ye(),ve({padding:8})]}).then(({x:xe,y:$e})=>{Object.assign(u.style,{left:`${xe}px`,top:`${$e}px`})})},we=function(){if(se)return;const p=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:[];C(M,p),se=!0,u.style.display="block",Te(),O(),re=ae(r,u,Te)},Le=function(){se&&(se=!1,u.style.display="none",re&&(re(),re=null))},De=function(){fe(),oe=setTimeout(()=>{we()},j)},Ae=function(){fe(),le=setTimeout(()=>{Le()},P)};if(b){const p=e&&e.indicatorTemplate!=null?e.indicatorTemplate:h&&typeof h.getIndicatorTemplate=="function"?h.getIndicatorTemplate():null;if(p){const _=R(p,e);_&&(_.classList.add("weui-dropdown-indicator"),typeof e.template=="string"&&/\{\{\s*indicator\s*\}\}/.test(e.template)||r.appendChild(_))}}else{const p=document.createElement("span");p.textContent="â€º",p.style.float="right",p.style.opacity="0.6",p.style.fontSize="14px",p.style.userSelect="none",r.appendChild(p)}const H=e.submenu&&e.submenu.template!=null?e.submenu.template:typeof g.getTemplate=="function"?g.getTemplate():null,te=!!H;let u,M;te?(u=B(H,e)||document.createElement("div"),M=u.querySelector('[data-menu-list="1"]')||u.querySelector(".weui-dropdown-list"),M||(M=document.createElement("div"),M.className="weui-dropdown-list",u.appendChild(M)),u.style.position="fixed",u.style.zIndex=String(J+1),u.style.display="none"):(u=document.createElement("div"),u.className="weui-dropdown",u.style.position="fixed",u.style.zIndex=String(J+1),u.style.display="none",u.style.minWidth="160px",u.style.background="var(--weui-dropdown-bg)",u.style.borderRadius="12px",u.style.boxShadow="var(--weui-dropdown-shadow)",u.style.border="0",u.style.padding="8px 0",M=document.createElement("div"),M.className="weui-dropdown-list",u.appendChild(M)),document.body.appendChild(u),C(M,i);let re=null,se=!1,oe=null,le=null;S?(u.addEventListener("mouseenter",()=>{e.submenu&&(e.submenu.isHover=!0)}),u.addEventListener("mouseleave",p=>{e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(p),e.submenu&&(e.submenu.isHover=!1)})):(r.addEventListener("mouseenter",()=>{De()}),r.addEventListener("mouseleave",p=>{const _=p.relatedTarget;u.contains(_)||Ae()}),u.addEventListener("mouseenter",()=>{fe(),O(),e.submenu&&(e.submenu.isHover=!0)}),u.addEventListener("mouseleave",p=>{const _=p.relatedTarget;r.contains(_)||Ae(),e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(p),e.submenu&&(e.submenu.isHover=!1)})),G={el:u,listEl:M,parentEl:r,open:we,close:Le,renderItemsTo:(p,_)=>C(p,_)},L.push(G),e.submenu&&(e.submenu.__ref=G,e.submenu.ui={$submenu:u},e.submenu.isOpen=!1,e.submenu.refresh=()=>{const p=Array.isArray(e.submenu.children)?e.submenu.children:[];C(M,p)},e.submenu.show=()=>{G.open(),e.submenu.isOpen=!0},e.submenu.hide=()=>{G.close(),e.submenu.isOpen=!1})}r.addEventListener("click",H=>{e.disabled||(f?S?e.onClick&&e.onClick(H):G&&G.open():(e.onClick&&e.onClick(H),N&&w()))}),n.appendChild(r)})}let k=null,E=!1;function U(){pe(t,o,{placement:D,strategy:"fixed",middleware:[me(8),ye(),ve({padding:8}),A?Me({element:v}):void 0]}).then(({x:n,y:l,middlewareData:e,placement:d})=>{Object.assign(o.style,{left:`${n}px`,top:`${l}px`});const{x:i=0,y:f=0}=e.arrow||{},b={top:"bottom",right:"left",bottom:"top",left:"right"}[d.split("-")[0]];Object.assign(v.style,{left:i!=null?`${i}px`:"",top:f!=null?`${f}px`:"",right:"",bottom:""}),A&&(v.style[b]="-5px")})}function z(){E||(q(),C(s,$(a)),E=!0,o.style.display="block",U(),k=ae(t,o,U),c&&document.addEventListener("mousedown",Ee,!0),document.addEventListener("keydown",he,!0))}function w(){E&&(E=!1,o.style.display="none",I(),k&&(k(),k=null),document.removeEventListener("mousedown",Ee,!0),document.removeEventListener("keydown",he,!0),W&&W())}function X(){E?w():z()}function ce(){w(),o.remove(),t&&(t.removeEventListener("mouseenter",Q),t.removeEventListener("mouseleave",Y),t.removeEventListener("focus",ee,!0),t.removeEventListener("blur",ne,!0)),o.removeEventListener("mouseenter",be),o.removeEventListener("mouseleave",ge)}let K=null,Z=null,F=!1;function O(){K&&(clearTimeout(K),K=null),Z&&(clearTimeout(Z),Z=null)}function m(){O(),K=setTimeout(()=>{z()},j)}function x(){O(),Z=setTimeout(()=>{w()},P)}function Q(){m()}function Y(n){const l=n.relatedTarget,e=L.some(d=>d.el.contains(l));!o.contains(l)&&!e&&x()}function be(){F=!0,O(),a&&typeof a.onMouseEnter=="function"&&a.onMouseEnter(),a&&!Array.isArray(a.children)&&!Array.isArray(a.menus)&&(a.isHover=!0)}function ge(n){F=!1,a&&typeof a.onMouseLeave=="function"&&a.onMouseLeave(n),a&&!Array.isArray(a.children)&&!Array.isArray(a.menus)&&(a.isHover=!1)}function ee(){m()}function ne(n){const l=n.relatedTarget;o.contains(l)||x()}function Ee(n){const l=n.target,e=L.some(d=>d.el.contains(l));!o.contains(l)&&!e&&l!==t&&w()}function he(n){if(n.key==="Escape"){w();return}if(!E)return;const l=Array.from(s.querySelectorAll('[data-menu-item="1"]')),e=document.activeElement,d=l.indexOf(e);if(n.key==="ArrowDown")n.preventDefault(),(l[Math.min(d+1,l.length-1)]||l[0]).focus();else if(n.key==="ArrowUp")n.preventDefault(),(l[Math.max(d-1,0)]||l[l.length-1]).focus();else if(n.key==="Enter"&&e&&e.dataset&&e.dataset.menuItem==="1")e.click();else if(!S&&n.key==="ArrowRight"&&e&&e.dataset&&e.dataset.menuItem==="1"){const i=L.find(f=>f.parentEl===e);if(i){n.preventDefault(),i.open();const b=Array.from(i.listEl.querySelectorAll('[data-menu-item="1"]'))[0];b&&b.focus()}}else if(!S&&n.key==="ArrowLeft"&&e){const i=L.find(f=>f.el.contains(e));i&&(n.preventDefault(),i.close(),i.parentEl.focus())}}return C(s,$(a)),document.body.appendChild(o),S||t&&(t.addEventListener("mouseenter",Q),t.addEventListener("mouseleave",Y),t.addEventListener("focus",ee,!0),t.addEventListener("blur",ne,!0)),o.addEventListener("mouseenter",be),o.addEventListener("mouseleave",ge),{el:o,open:z,close:w,toggle:X,destroy:ce,show:z,hide:w,get isHover(){return F},ui:{$trigger:{onMouseEnter(n){t.addEventListener("mouseenter",n)},onMouseLeave(n){t.addEventListener("mouseleave",l=>{setTimeout(()=>{n(l)},100)})},onClick(n){t.addEventListener("click",n)},onFocus(n){t.addEventListener("focus",n,!0)},onBlur(n){t.addEventListener("blur",n,!0)}}},setMenus(n){q(),C(s,$(n)),E&&U()},setTrigger(n){t!==n&&(!S&&t&&(t.removeEventListener("mouseenter",Q),t.removeEventListener("mouseleave",Y),t.removeEventListener("focus",ee,!0),t.removeEventListener("blur",ne,!0)),t=n,!S&&t&&(t.addEventListener("mouseenter",Q),t.addEventListener("mouseleave",Y),t.addEventListener("focus",ee,!0),t.addEventListener("blur",ne,!0)),E&&(k&&(k(),k=null),U(),k=ae(t,o,U)))}}}const{computePosition:ke,offset:_e,flip:Se,shift:Ie,autoUpdate:Oe}=window.FloatingUIDOM;function He(y,T={}){let t=y,a=T;t&&t.$trigger&&(a=t,t=t.$trigger);const{content:D="",placement:c="bottom-start",closeOnClickOutside:N=!0,onClose:j=null,manual:P=!1,trigger:A="click",hoverOpenDelay:W=200,hoverCloseDelay:S=200,zIndex:de=1e3,className:J="",keepAliveSelectors:V=[]}=a,o=Number(de)||1e3,s=document.createElement("div");s.className=`weui-popover ${J}`,s.style.position="fixed",s.style.zIndex=String(o),s.style.display="none",s.style.minWidth="100px",s.style.background="var(--weui-dropdown-bg)",s.style.color="var(--weui-dropdown-fg)",s.style.borderRadius="8px",s.style.boxShadow="var(--weui-dropdown-shadow)",s.style.padding="12px",s.style.fontSize="14px",s.style.lineHeight="1.4",s.style.boxSizing="border-box";const v=document.createElement("div");v.className="weui-popover-content";let L=D;typeof D=="function"&&(L=D()),L instanceof Node?v.appendChild(L):v.innerHTML=String(L),s.appendChild(v),document.body.appendChild(s);let q=null,I=!1,R=null,B=null;const C=new Set;function k(){ke(t,s,{placement:c,strategy:"fixed",middleware:[_e(8),Se(),Ie({padding:8})]}).then(({x:m,y:x})=>{Object.assign(s.style,{left:`${m}px`,top:`${x}px`})})}function E(){R&&(clearTimeout(R),R=null),B&&(clearTimeout(B),B=null)}function U(m){if(!m)return!1;if(s.contains(m)||t.contains(m))return!0;for(const x of C)if(x&&(x===m||x.contains(m)))return!0;for(const x of V||[])if(m.closest&&m.closest(x))return!0;return!1}function z(){E(),!I&&(I=!0,s.style.display="block",k(),q=Oe(t,s,k),A==="click"&&N&&setTimeout(()=>{document.addEventListener("click",K,!0)},0))}function w(){E(),I&&(I=!1,s.style.display="none",q&&(q(),q=null),document.removeEventListener("click",K,!0),j&&j())}function X(){I?w():z()}function ce(){w(),s.remove(),E(),P||(A==="click"?t.removeEventListener("click",Z):A==="hover"&&(t.removeEventListener("mouseenter",F),t.removeEventListener("mouseleave",O),s.removeEventListener("mouseenter",F),s.removeEventListener("mouseleave",O)))}function K(m){I&&(U(m.target)||w())}function Z(m){X()}function F(){E(),!I&&(R=setTimeout(()=>{z()},W))}function O(){E(),I&&(B=setTimeout(()=>{w()},S))}return P||(A==="click"?t.addEventListener("click",Z):A==="hover"&&(t.addEventListener("mouseenter",F),t.addEventListener("mouseleave",O),s.addEventListener("mouseenter",F),s.addEventListener("mouseleave",m=>{const x=m&&m.relatedTarget;if(U(x)){E();return}O()}))),{open:z,close:w,toggle:X,destroy:ce,el:s,attachPortalElement(m){m&&C.add(m)},detachPortalElement(m){m&&C.delete(m)}}}return{DropdownMenu:Ce,Menu:g,MenuItem:h,Popover:He}}));
