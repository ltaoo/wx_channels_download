(function(N,b){typeof exports=="object"&&typeof module<"u"?module.exports=b():typeof define=="function"&&define.amd?define(b):(N=typeof globalThis<"u"?globalThis:N||self,N.WUI=b())})(this,(function(){"use strict";function N(y){return Array.isArray(y)?y:y&&Array.isArray(y.children)?y.children:y&&Array.isArray(y.menus)?y.menus:[]}function b(y={}){const{children:E=[],menus:t=null,onMouseLeave:u=null,template:$=null}=y,c={children:Array.isArray(E)?E:Array.isArray(t)?t:[],isOpen:!1,isHover:!1,template:$||b._DEFAULT_TEMPLATE||null,show(){c.isOpen=!0,c.__ref&&c.__ref.open&&c.__ref.open()},hide(){c.isOpen=!1,c.__ref&&c.__ref.close&&c.__ref.close()},setChildren(P){c.children=N(P),c.__ref&&c.__ref.listEl&&(c.__ref.listEl.innerHTML=""),c.__ref&&typeof c.__ref.renderItemsTo=="function"&&c.__ref.listEl?c.__ref.renderItemsTo(c.__ref.listEl,c.children):typeof c.refresh=="function"&&c.refresh()},onMouseLeave:u,ui:{$submenu:null},__ref:null};return c}b._DEFAULT_TEMPLATE=null,b.setTemplate=function(E){b._DEFAULT_TEMPLATE=E},b.getTemplate=function(){return b._DEFAULT_TEMPLATE};let ue=null,ae=null;function g(y={}){const{label:E="",disabled:t=!1,onClick:u=null,onMouseEnter:$=null,onMouseLeave:c=null,children:P=null,submenu:z=null,menus:U=null,template:L=null,indicatorTemplate:F=null}=y;return{label:E,disabled:t,onClick:u,onMouseEnter:$,onMouseLeave:c,children:Array.isArray(P)?P:Array.isArray(U)?U:null,submenu:z||null,isHover:!1,ui:{},template:L??ue,indicatorTemplate:F??ae}}g.setTemplate=function(E){ue=E},g.getTemplate=function(){return ue},g.setIndicatorTemplate=function(E){ae=E},g.getIndicatorTemplate=function(){return ae};const{computePosition:pe,offset:me,flip:ye,shift:ve,autoUpdate:de,arrow:Me}=window.FloatingUIDOM;function Ce(y,E={}){let t=y,u=E;t&&t.$trigger&&(u=t,t=t.$trigger);const{placement:$="bottom-start",closeOnClickOutside:c=!0,closeOnSelect:P=!1,hoverOpenDelay:z=80,hoverCloseDelay:U=120,showArrow:L=!1,onClose:F=null,manual:H=!0,zIndex:ce=1e3}=u,G=Number(ce)||1e3,Y=u&&u.template!=null?u.template:typeof b.getTemplate=="function"?b.getTemplate():null;let o,h;Y?(o=W(Y,u)||document.createElement("div"),h=o.querySelector('[data-menu-list="1"]')||o.querySelector(".weui-dropdown-list"),h||(h=document.createElement("div"),h.className="weui-dropdown-list",o.appendChild(h)),o.style.position="fixed",o.style.zIndex=String(G),o.style.display="none"):(o=document.createElement("div"),o.className="weui-dropdown",o.style.position="fixed",o.style.zIndex=String(G),o.style.display="none",o.style.minWidth="160px",o.style.background="var(--weui-dropdown-bg)",o.style.borderRadius="12px",o.style.boxShadow="var(--weui-dropdown-shadow)",o.style.border="0",o.style.padding="8px 0",h=document.createElement("div"),h.className="weui-dropdown-list",o.appendChild(h));const s=document.createElement("div");s.className="weui-dropdown-arrow",s.style.position="absolute",s.style.width="10px",s.style.height="10px",s.style.background="var(--weui-dropdown-bg)",s.style.borderLeft="0",s.style.borderTop="0",s.style.transform="rotate(45deg)",s.style.pointerEvents="none",s.style.display=L?"block":"none",o.appendChild(s);const w=[];function j(){w.forEach(n=>{n.close(),n.el.remove()}),w.length=0}function J(){w.forEach(n=>n.close())}function _(n,l,e){if(typeof n=="function"){const d=n(l);if(d instanceof Node)return d;if(typeof d=="string"){const i=document.createElement("div");let f=d.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));const v=l&&l.indicatorTemplate!=null?l.indicatorTemplate:g&&typeof g.getIndicatorTemplate=="function"?g.getIndicatorTemplate():null;return v&&e&&/\{\{\s*indicator\s*\}\}/.test(f)&&(typeof v=="string"?f=f.replace(/\{\{\s*indicator\s*\}\}/g,v):f=f.replace(/\{\{\s*indicator\s*\}\}/g,"")),i.innerHTML=f,i.firstElementChild||i}return null}if(n instanceof Node)return n;if(typeof n=="string"){const d=document.createElement("div");let i=n.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));const f=l&&l.indicatorTemplate!=null?l.indicatorTemplate:g&&typeof g.getIndicatorTemplate=="function"?g.getIndicatorTemplate():null;return f&&e&&/\{\{\s*indicator\s*\}\}/.test(i)&&(typeof f=="string"?i=i.replace(/\{\{\s*indicator\s*\}\}/g,f):i=i.replace(/\{\{\s*indicator\s*\}\}/g,"")),d.innerHTML=i,d.firstElementChild||d}return null}function W(n,l){const e=()=>'<div class="weui-dropdown-list" data-menu-list="1"></div>';if(typeof n=="function"){const d=n(l);if(d instanceof Node)return d;if(typeof d=="string"){const i=document.createElement("div");let f=d.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));return f=f.replace(/\{\{\s*list\s*\}\}/g,e()),i.innerHTML=f,i.firstElementChild||i}return null}if(n instanceof Node)return n;if(typeof n=="string"){const d=document.createElement("div");let i=n.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));return i=i.replace(/\{\{\s*list\s*\}\}/g,e()),d.innerHTML=i,d.firstElementChild||d}return null}function A(n,l){n.innerHTML="",l.forEach((e,d)=>{const i=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:null;let f=Array.isArray(i)&&i.length>0;const v=!!(e&&e.template!=null);let r;v?r=_(e.template,e,f)||document.createElement("div"):(r=document.createElement("button"),r.type="button",r.className="weui-dropdown-item",r.innerHTML=e.label,r.style.display="block",r.style.width="100%",r.style.textAlign="left",r.style.padding="12px 16px",r.style.fontSize="15px",r.style.color="var(--weui-dropdown-fg)",r.style.background="transparent",r.style.border="0",r.style.cursor="pointer",r.style.outline="none"),r.dataset.index=String(d),r.dataset.menuItem="1",!v&&e.disabled&&(r.disabled=!0,r.style.opacity="0.5",r.style.cursor="not-allowed"),e.disabled?(r.setAttribute("aria-disabled","true"),v&&(r.tabIndex=-1)):v&&!(r instanceof HTMLButtonElement)&&!(r instanceof HTMLAnchorElement)&&(r.tabIndex=0,r.setAttribute("role","menuitem")),r.addEventListener("mouseenter",()=>{v||(r.style.background="var(--weui-dropdown-hover-bg)"),e.onMouseEnter&&e.onMouseEnter(),e&&(e.isHover=!0)}),r.addEventListener("mouseleave",D=>{v||(r.style.background="transparent"),setTimeout(()=>{e&&(e.isHover=!1),e.onMouseLeave&&e.onMouseLeave(D);const se=e&&e.submenu&&e.submenu.ui&&e.submenu.ui.$submenu;se&&D&&D.relatedTarget&&se.contains(D.relatedTarget)?e.submenu.isHover=!0:e&&e.submenu&&(e.submenu.isHover=!1)},100)});let Z=null;if(f){let fe=function(){le&&(clearTimeout(le),le=null),ie&&(clearTimeout(ie),ie=null)},Te=function(){const p=r.closest(".weui-dropdown")||r.closest(".custom-menu")||o,I=p&&parseFloat(window.getComputedStyle(p).paddingRight)||0;pe(r,a,{placement:"right-start",strategy:"fixed",middleware:[me(()=>8+I),ye(),ve({padding:8})]}).then(({x:xe,y:$e})=>{Object.assign(a.style,{left:`${xe}px`,top:`${$e}px`})})},we=function(){if(oe)return;const p=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:[];A(k,p),oe=!0,a.style.display="block",Te(),O(),re=de(r,a,Te)},Le=function(){oe&&(oe=!1,a.style.display="none",re&&(re(),re=null))},De=function(){fe(),le=setTimeout(()=>{we()},z)},Ae=function(){fe(),ie=setTimeout(()=>{Le()},U)};if(v){const p=e&&e.indicatorTemplate!=null?e.indicatorTemplate:g&&typeof g.getIndicatorTemplate=="function"?g.getIndicatorTemplate():null;if(p){const I=_(p,e);I&&(I.classList.add("weui-dropdown-indicator"),typeof e.template=="string"&&/\{\{\s*indicator\s*\}\}/.test(e.template)||r.appendChild(I))}}else{const p=document.createElement("span");p.textContent="â€º",p.style.float="right",p.style.opacity="0.6",p.style.fontSize="14px",p.style.userSelect="none",r.appendChild(p)}const D=e.submenu&&e.submenu.template!=null?e.submenu.template:typeof b.getTemplate=="function"?b.getTemplate():null,se=!!D;let a,k;se?(a=W(D,e)||document.createElement("div"),k=a.querySelector('[data-menu-list="1"]')||a.querySelector(".weui-dropdown-list"),k||(k=document.createElement("div"),k.className="weui-dropdown-list",a.appendChild(k)),a.style.position="fixed",a.style.zIndex=String(G+1),a.style.display="none"):(a=document.createElement("div"),a.className="weui-dropdown",a.style.position="fixed",a.style.zIndex=String(G+1),a.style.display="none",a.style.minWidth="160px",a.style.background="var(--weui-dropdown-bg)",a.style.borderRadius="12px",a.style.boxShadow="var(--weui-dropdown-shadow)",a.style.border="0",a.style.padding="8px 0",k=document.createElement("div"),k.className="weui-dropdown-list",a.appendChild(k)),document.body.appendChild(a),A(k,i);let re=null,oe=!1,le=null,ie=null;H?(a.addEventListener("mouseenter",()=>{e.submenu&&(e.submenu.isHover=!0)}),a.addEventListener("mouseleave",p=>{e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(p),e.submenu&&(e.submenu.isHover=!1)})):(r.addEventListener("mouseenter",()=>{De()}),r.addEventListener("mouseleave",p=>{const I=p.relatedTarget;a.contains(I)||Ae()}),a.addEventListener("mouseenter",()=>{fe(),O(),e.submenu&&(e.submenu.isHover=!0)}),a.addEventListener("mouseleave",p=>{const I=p.relatedTarget;r.contains(I)||Ae(),e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(p),e.submenu&&(e.submenu.isHover=!1)})),Z={el:a,listEl:k,parentEl:r,open:we,close:Le,renderItemsTo:(p,I)=>A(p,I)},w.push(Z),e.submenu&&(e.submenu.__ref=Z,e.submenu.ui={$submenu:a},e.submenu.isOpen=!1,e.submenu.refresh=()=>{const p=Array.isArray(e.submenu.children)?e.submenu.children:[];A(k,p)},e.submenu.show=()=>{Z.open(),e.submenu.isOpen=!0},e.submenu.hide=()=>{Z.close(),e.submenu.isOpen=!1})}r.addEventListener("click",D=>{e.disabled||(f?H?e.onClick&&e.onClick(D):Z&&Z.open():(e.onClick&&e.onClick(D),P&&C()))}),n.appendChild(r)})}let x=null,S=!1;function M(){pe(t,o,{placement:$,strategy:"fixed",middleware:[me(8),ye(),ve({padding:8}),L?Me({element:s}):void 0]}).then(({x:n,y:l,middlewareData:e,placement:d})=>{Object.assign(o.style,{left:`${n}px`,top:`${l}px`});const{x:i=0,y:f=0}=e.arrow||{},v={top:"bottom",right:"left",bottom:"top",left:"right"}[d.split("-")[0]];Object.assign(s.style,{left:i!=null?`${i}px`:"",top:f!=null?`${f}px`:"",right:"",bottom:""}),L&&(s.style[v]="-5px")})}function q(){S||(j(),A(h,N(u)),S=!0,o.style.display="block",M(),x=de(t,o,M),c&&document.addEventListener("mousedown",Ee,!0),document.addEventListener("keydown",he,!0))}function C(){S&&(S=!1,o.style.display="none",J(),x&&(x(),x=null),document.removeEventListener("mousedown",Ee,!0),document.removeEventListener("keydown",he,!0),F&&F())}function R(){S?C():q()}function ee(){C(),o.remove(),t&&(t.removeEventListener("mouseenter",T),t.removeEventListener("mouseleave",X),t.removeEventListener("focus",ne,!0),t.removeEventListener("blur",te,!0)),o.removeEventListener("mouseenter",be),o.removeEventListener("mouseleave",ge)}let Q=null,B=null,V=!1;function O(){Q&&(clearTimeout(Q),Q=null),B&&(clearTimeout(B),B=null)}function K(){O(),Q=setTimeout(()=>{q()},z)}function m(){O(),B=setTimeout(()=>{C()},U)}function T(){K()}function X(n){const l=n.relatedTarget,e=w.some(d=>d.el.contains(l));!o.contains(l)&&!e&&m()}function be(){V=!0,O(),u&&typeof u.onMouseEnter=="function"&&u.onMouseEnter(),u&&!Array.isArray(u.children)&&!Array.isArray(u.menus)&&(u.isHover=!0)}function ge(n){V=!1,u&&typeof u.onMouseLeave=="function"&&u.onMouseLeave(n),u&&!Array.isArray(u.children)&&!Array.isArray(u.menus)&&(u.isHover=!1)}function ne(){K()}function te(n){const l=n.relatedTarget;o.contains(l)||m()}function Ee(n){const l=n.target,e=w.some(d=>d.el.contains(l));!o.contains(l)&&!e&&l!==t&&C()}function he(n){if(n.key==="Escape"){C();return}if(!S)return;const l=Array.from(h.querySelectorAll('[data-menu-item="1"]')),e=document.activeElement,d=l.indexOf(e);if(n.key==="ArrowDown")n.preventDefault(),(l[Math.min(d+1,l.length-1)]||l[0]).focus();else if(n.key==="ArrowUp")n.preventDefault(),(l[Math.max(d-1,0)]||l[l.length-1]).focus();else if(n.key==="Enter"&&e&&e.dataset&&e.dataset.menuItem==="1")e.click();else if(!H&&n.key==="ArrowRight"&&e&&e.dataset&&e.dataset.menuItem==="1"){const i=w.find(f=>f.parentEl===e);if(i){n.preventDefault(),i.open();const v=Array.from(i.listEl.querySelectorAll('[data-menu-item="1"]'))[0];v&&v.focus()}}else if(!H&&n.key==="ArrowLeft"&&e){const i=w.find(f=>f.el.contains(e));i&&(n.preventDefault(),i.close(),i.parentEl.focus())}}return A(h,N(u)),document.body.appendChild(o),H||t&&(t.addEventListener("mouseenter",T),t.addEventListener("mouseleave",X),t.addEventListener("focus",ne,!0),t.addEventListener("blur",te,!0)),o.addEventListener("mouseenter",be),o.addEventListener("mouseleave",ge),{el:o,open:q,close:C,toggle:R,destroy:ee,show:q,hide:C,get isHover(){return V},ui:{$trigger:{onMouseEnter(n){t.addEventListener("mouseenter",n)},onMouseLeave(n){t.addEventListener("mouseleave",l=>{setTimeout(()=>{n(l)},100)})},onClick(n){t.addEventListener("click",n)},onFocus(n){t.addEventListener("focus",n,!0)},onBlur(n){t.addEventListener("blur",n,!0)}}},setMenus(n){this.setChildren(n)},setChildren(n){const l=N(n);u.children=l,u.menus&&delete u.menus,j(),A(h,l),S&&M()},setTrigger(n){t!==n&&(!H&&t&&(t.removeEventListener("mouseenter",T),t.removeEventListener("mouseleave",X),t.removeEventListener("focus",ne,!0),t.removeEventListener("blur",te,!0)),t=n,!H&&t&&(t.addEventListener("mouseenter",T),t.addEventListener("mouseleave",X),t.addEventListener("focus",ne,!0),t.addEventListener("blur",te,!0)),S&&(x&&(x(),x=null),M(),x=de(t,o,M)))}}}const{computePosition:ke,offset:_e,flip:Se,shift:Ie,autoUpdate:He}=window.FloatingUIDOM;function Oe(y,E={}){let t=y,u=E;t&&t.$trigger&&(u=t,t=t.$trigger);const{content:$="",placement:c="bottom-start",closeOnClickOutside:P=!0,onClose:z=null,manual:U=!1,trigger:L="click",hoverOpenDelay:F=200,hoverCloseDelay:H=200,zIndex:ce=1e3,className:G="",keepAliveSelectors:Y=[],offset:o=8}=u,h=Number(ce)||1e3,s=document.createElement("div");s.className=`weui-popover ${G}`,s.style.position="fixed",s.style.zIndex=String(h),s.style.display="none",s.style.minWidth="100px",s.style.background="var(--weui-dropdown-bg)",s.style.color="var(--weui-dropdown-fg)",s.style.borderRadius="8px",s.style.boxShadow="var(--weui-dropdown-shadow)",s.style.padding="12px",s.style.fontSize="14px",s.style.lineHeight="1.4",s.style.boxSizing="border-box";const w=document.createElement("div");w.className="weui-popover-content";let j=$;typeof $=="function"&&(j=$()),j instanceof Node?w.appendChild(j):w.innerHTML=String(j),s.appendChild(w),document.body.appendChild(s);let J=null,_=!1,W=null,A=null;const x=new Set;function S(){ke(t,s,{placement:c,strategy:"fixed",middleware:[_e(o),Se(),Ie({padding:8})]}).then(({x:m,y:T})=>{Object.assign(s.style,{left:`${m}px`,top:`${T}px`})})}function M(){W&&(clearTimeout(W),W=null),A&&(clearTimeout(A),A=null)}function q(m){if(!m)return!1;if(s.contains(m)||t.contains(m))return!0;for(const T of x)if(T&&(T===m||T.contains(m)))return!0;for(const T of Y||[])if(m.closest&&m.closest(T))return!0;return!1}function C(){M(),!_&&(_=!0,s.style.display="block",S(),J=He(t,s,S),L==="click"&&P&&setTimeout(()=>{document.addEventListener("click",B,!0)},0))}function R(){M(),_&&(_=!1,s.style.display="none",J&&(J(),J=null),document.removeEventListener("click",B,!0),z&&z())}function ee(){_?R():C()}function Q(){R(),s.remove(),M(),U||(L==="click"?t.removeEventListener("click",V):L==="hover"&&(t.removeEventListener("mouseenter",O),t.removeEventListener("mouseleave",K),s.removeEventListener("mouseenter",O),s.removeEventListener("mouseleave",K)))}function B(m){_&&(q(m.target)||R())}function V(m){ee()}function O(){M(),!_&&(W=setTimeout(()=>{C()},F))}function K(){M(),_&&(A=setTimeout(()=>{R()},H))}return U||(L==="click"?t.addEventListener("click",V):L==="hover"&&(t.addEventListener("mouseenter",O),t.addEventListener("mouseleave",K),s.addEventListener("mouseenter",O),s.addEventListener("mouseleave",m=>{const T=m&&m.relatedTarget;if(q(T)){M();return}K()}))),{open:C,close:R,toggle:ee,destroy:Q,el:s,attachPortalElement(m){m&&x.add(m)},detachPortalElement(m){m&&x.delete(m)}}}return{DropdownMenu:Ce,Menu:b,MenuItem:g,Popover:Oe}}));
