(function(O,b){typeof exports=="object"&&typeof module<"u"?module.exports=b():typeof define=="function"&&define.amd?define(b):(O=typeof globalThis<"u"?globalThis:O||self,O.Weui=b())})(this,(function(){"use strict";function O(p){return Array.isArray(p)?p:p&&Array.isArray(p.children)?p.children:p&&Array.isArray(p.menus)?p.menus:[]}function b(p={}){const{children:E=[],menus:s=null,onMouseLeave:u=null,template:S=null}=p,d={children:Array.isArray(E)?E:Array.isArray(s)?s:[],isOpen:!1,isHover:!1,template:S||b._DEFAULT_TEMPLATE||null,show(){d.isOpen=!0,d.__ref&&d.__ref.open&&d.__ref.open()},hide(){d.isOpen=!1,d.__ref&&d.__ref.close&&d.__ref.close()},setChildren(H){d.children=O(H),d.__ref&&d.__ref.listEl&&(d.__ref.listEl.innerHTML=""),d.__ref&&typeof d.__ref.renderItemsTo=="function"&&d.__ref.listEl?d.__ref.renderItemsTo(d.__ref.listEl,d.children):typeof d.refresh=="function"&&d.refresh()},onMouseLeave:u,ui:{$submenu:null},__ref:null};return d}b._DEFAULT_TEMPLATE=null,b.setTemplate=function(E){b._DEFAULT_TEMPLATE=E},b.getTemplate=function(){return b._DEFAULT_TEMPLATE};let te=null,oe=null;function g(p={}){const{label:E="",disabled:s=!1,onClick:u=null,onMouseEnter:S=null,onMouseLeave:d=null,children:H=null,submenu:P=null,menus:D=null,template:L=null,indicatorTemplate:U=null}=p;return{label:E,disabled:s,onClick:u,onMouseEnter:S,onMouseLeave:d,children:Array.isArray(H)?H:Array.isArray(D)?D:null,submenu:P||null,isHover:!1,ui:{},template:L??te,indicatorTemplate:U??oe}}g.setTemplate=function(E){te=E},g.getTemplate=function(){return te},g.setIndicatorTemplate=function(E){oe=E},g.getIndicatorTemplate=function(){return oe};const{computePosition:le,offset:ie,flip:ue,shift:ae,autoUpdate:de,arrow:Me}=window.FloatingUIDOM;function Ce(p,E={}){let s=p,u=E;s&&s.$trigger&&(u=s,s=s.$trigger);const{placement:S="bottom-start",closeOnClickOutside:d=!0,closeOnSelect:H=!1,hoverOpenDelay:P=80,hoverCloseDelay:D=120,showArrow:L=!1,onClose:U=null,manual:$=!0,zIndex:se=1e3}=u,j=Number(se)||1e3,J=u&&u.template!=null?u.template:typeof b.getTemplate=="function"?b.getTemplate():null;let n,y;J?(n=Z(J,u)||document.createElement("div"),y=n.querySelector('[data-menu-list="1"]')||n.querySelector(".weui-dropdown-list"),y||(y=document.createElement("div"),y.className="weui-dropdown-list",n.appendChild(y)),n.style.position="fixed",n.style.zIndex=String(j),n.style.display="none"):(n=document.createElement("div"),n.className="weui-dropdown",n.style.position="fixed",n.style.zIndex=String(j),n.style.display="none",n.style.minWidth="160px",n.style.background="var(--weui-dropdown-bg)",n.style.borderRadius="12px",n.style.boxShadow="var(--weui-dropdown-shadow)",n.style.border="0",n.style.padding="8px 0",y=document.createElement("div"),y.className="weui-dropdown-list",n.appendChild(y));const m=document.createElement("div");m.className="weui-dropdown-arrow",m.style.position="absolute",m.style.width="10px",m.style.height="10px",m.style.background="var(--weui-dropdown-bg)",m.style.borderLeft="0",m.style.borderTop="0",m.style.transform="rotate(45deg)",m.style.pointerEvents="none",m.style.display=L?"block":"none",n.appendChild(m);const h=[];function x(){h.forEach(t=>{t.close(),t.el.remove()}),h.length=0}function q(){h.forEach(t=>t.close())}function z(t,r,e){if(typeof t=="function"){const a=t(r);if(a instanceof Node)return a;if(typeof a=="string"){const l=document.createElement("div");let c=a.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));const v=r&&r.indicatorTemplate!=null?r.indicatorTemplate:g&&typeof g.getIndicatorTemplate=="function"?g.getIndicatorTemplate():null;return v&&e&&/\{\{\s*indicator\s*\}\}/.test(c)&&(typeof v=="string"?c=c.replace(/\{\{\s*indicator\s*\}\}/g,v):c=c.replace(/\{\{\s*indicator\s*\}\}/g,"")),l.innerHTML=c,l.firstElementChild||l}return null}if(t instanceof Node)return t;if(typeof t=="string"){const a=document.createElement("div");let l=t.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));const c=r&&r.indicatorTemplate!=null?r.indicatorTemplate:g&&typeof g.getIndicatorTemplate=="function"?g.getIndicatorTemplate():null;return c&&e&&/\{\{\s*indicator\s*\}\}/.test(l)&&(typeof c=="string"?l=l.replace(/\{\{\s*indicator\s*\}\}/g,c):l=l.replace(/\{\{\s*indicator\s*\}\}/g,"")),a.innerHTML=l,a.firstElementChild||a}return null}function Z(t,r){const e=()=>'<div class="weui-dropdown-list" data-menu-list="1"></div>';if(typeof t=="function"){const a=t(r);if(a instanceof Node)return a;if(typeof a=="string"){const l=document.createElement("div");let c=a.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));return c=c.replace(/\{\{\s*list\s*\}\}/g,e()),l.innerHTML=c,l.firstElementChild||l}return null}if(t instanceof Node)return t;if(typeof t=="string"){const a=document.createElement("div");let l=t.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));return l=l.replace(/\{\{\s*list\s*\}\}/g,e()),a.innerHTML=l,a.firstElementChild||a}return null}function T(t,r){t.innerHTML="",r.forEach((e,a)=>{const l=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:null;let c=Array.isArray(l)&&l.length>0;const v=!!(e&&e.template!=null);let o;v?o=z(e.template,e,c)||document.createElement("div"):(o=document.createElement("button"),o.type="button",o.className="weui-dropdown-item",o.textContent=e.label,o.style.display="block",o.style.width="100%",o.style.textAlign="left",o.style.padding="12px 16px",o.style.fontSize="15px",o.style.color="var(--weui-dropdown-fg)",o.style.background="transparent",o.style.border="0",o.style.cursor="pointer",o.style.outline="none"),o.dataset.index=String(a),o.dataset.menuItem="1",!v&&e.disabled&&(o.disabled=!0,o.style.opacity="0.5",o.style.cursor="not-allowed"),e.disabled?(o.setAttribute("aria-disabled","true"),v&&(o.tabIndex=-1)):v&&!(o instanceof HTMLButtonElement)&&!(o instanceof HTMLAnchorElement)&&(o.tabIndex=0,o.setAttribute("role","menuitem")),o.addEventListener("mouseenter",()=>{v||(o.style.background="var(--weui-dropdown-hover-bg)"),e.onMouseEnter&&e.onMouseEnter(),e&&(e.isHover=!0)}),o.addEventListener("mouseleave",k=>{v||(o.style.background="transparent"),setTimeout(()=>{e&&(e.isHover=!1),e.onMouseLeave&&e.onMouseLeave(k);const V=e&&e.submenu&&e.submenu.ui&&e.submenu.ui.$submenu;V&&k&&k.relatedTarget&&V.contains(k.relatedTarget)?e.submenu.isHover=!0:e&&e.submenu&&(e.submenu.isHover=!1)},100)});let F=null;if(c){let re=function(){ee&&(clearTimeout(ee),ee=null),ne&&(clearTimeout(ne),ne=null)},Te=function(){const f=o.closest(".weui-dropdown")||o.closest(".custom-menu")||n,C=f&&parseFloat(window.getComputedStyle(f).paddingRight)||0;le(o,i,{placement:"right-start",strategy:"fixed",middleware:[ie(()=>8+C),ue(),ae({padding:8})]}).then(({x:xe,y:$e})=>{Object.assign(i.style,{left:`${xe}px`,top:`${$e}px`})})},we=function(){if(Y)return;const f=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:[];T(A,f),Y=!0,i.style.display="block",Te(),G(),X=de(o,i,Te)},Le=function(){Y&&(Y=!1,i.style.display="none",X&&(X(),X=null))},De=function(){re(),ee=setTimeout(()=>{we()},P)},Ae=function(){re(),ne=setTimeout(()=>{Le()},D)};if(v){const f=e&&e.indicatorTemplate!=null?e.indicatorTemplate:g&&typeof g.getIndicatorTemplate=="function"?g.getIndicatorTemplate():null;if(f){const C=z(f,e);C&&(C.classList.add("weui-dropdown-indicator"),typeof e.template=="string"&&/\{\{\s*indicator\s*\}\}/.test(e.template)||o.appendChild(C))}}else{const f=document.createElement("span");f.textContent="â€º",f.style.float="right",f.style.opacity="0.6",f.style.fontSize="14px",f.style.userSelect="none",o.appendChild(f)}const k=e.submenu&&e.submenu.template!=null?e.submenu.template:typeof b.getTemplate=="function"?b.getTemplate():null,V=!!k;let i,A;V?(i=Z(k,e)||document.createElement("div"),A=i.querySelector('[data-menu-list="1"]')||i.querySelector(".weui-dropdown-list"),A||(A=document.createElement("div"),A.className="weui-dropdown-list",i.appendChild(A)),i.style.position="fixed",i.style.zIndex=String(j+1),i.style.display="none"):(i=document.createElement("div"),i.className="weui-dropdown",i.style.position="fixed",i.style.zIndex=String(j+1),i.style.display="none",i.style.minWidth="160px",i.style.background="var(--weui-dropdown-bg)",i.style.borderRadius="12px",i.style.boxShadow="var(--weui-dropdown-shadow)",i.style.border="0",i.style.padding="8px 0",A=document.createElement("div"),A.className="weui-dropdown-list",i.appendChild(A)),document.body.appendChild(i),T(A,l);let X=null,Y=!1,ee=null,ne=null;$?(i.addEventListener("mouseenter",()=>{e.submenu&&(e.submenu.isHover=!0)}),i.addEventListener("mouseleave",f=>{e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(f),e.submenu&&(e.submenu.isHover=!1)})):(o.addEventListener("mouseenter",()=>{De()}),o.addEventListener("mouseleave",f=>{const C=f.relatedTarget;i.contains(C)||Ae()}),i.addEventListener("mouseenter",()=>{re(),G(),e.submenu&&(e.submenu.isHover=!0)}),i.addEventListener("mouseleave",f=>{const C=f.relatedTarget;o.contains(C)||Ae(),e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(f),e.submenu&&(e.submenu.isHover=!1)})),F={el:i,listEl:A,parentEl:o,open:we,close:Le,renderItemsTo:(f,C)=>T(f,C)},h.push(F),e.submenu&&(e.submenu.__ref=F,e.submenu.ui={$submenu:i},e.submenu.isOpen=!1,e.submenu.refresh=()=>{const f=Array.isArray(e.submenu.children)?e.submenu.children:[];T(A,f)},e.submenu.show=()=>{F.open(),e.submenu.isOpen=!0},e.submenu.hide=()=>{F.close(),e.submenu.isOpen=!1})}o.addEventListener("click",k=>{e.disabled||(c?$?e.onClick&&e.onClick(k):F&&F.open():(e.onClick&&e.onClick(k),H&&M()))}),t.appendChild(o)})}let N=null,w=!1;function R(){le(s,n,{placement:S,strategy:"fixed",middleware:[ie(8),ue(),ae({padding:8}),L?Me({element:m}):void 0]}).then(({x:t,y:r,middlewareData:e,placement:a})=>{Object.assign(n.style,{left:`${t}px`,top:`${r}px`});const{x:l=0,y:c=0}=e.arrow||{},v={top:"bottom",right:"left",bottom:"top",left:"right"}[a.split("-")[0]];Object.assign(m.style,{left:l!=null?`${l}px`:"",top:c!=null?`${c}px`:"",right:"",bottom:""}),L&&(m.style[v]="-5px")})}function W(){w||(x(),T(y,O(u)),w=!0,n.style.display="block",R(),N=de(s,n,R),d&&document.addEventListener("mousedown",Ee,!0),document.addEventListener("keydown",he,!0))}function M(){w&&(w=!1,n.style.display="none",q(),N&&(N(),N=null),document.removeEventListener("mousedown",Ee,!0),document.removeEventListener("keydown",he,!0),U&&U())}function Q(){w?M():W()}function B(){M(),n.remove(),s.removeEventListener("mouseenter",pe),s.removeEventListener("mouseleave",me),s.removeEventListener("focus",be,!0),s.removeEventListener("blur",ge,!0),n.removeEventListener("mouseenter",ye),n.removeEventListener("mouseleave",ve)}let I=null,_=null,K=!1;function G(){I&&(clearTimeout(I),I=null),_&&(clearTimeout(_),_=null)}function ce(){G(),I=setTimeout(()=>{W()},P)}function fe(){G(),_=setTimeout(()=>{M()},D)}function pe(){ce()}function me(t){const r=t.relatedTarget,e=h.some(a=>a.el.contains(r));!n.contains(r)&&!e&&fe()}function ye(){K=!0,G(),u&&typeof u.onMouseEnter=="function"&&u.onMouseEnter(),u&&!Array.isArray(u.children)&&!Array.isArray(u.menus)&&(u.isHover=!0)}function ve(t){K=!1,u&&typeof u.onMouseLeave=="function"&&u.onMouseLeave(t),u&&!Array.isArray(u.children)&&!Array.isArray(u.menus)&&(u.isHover=!1)}function be(){ce()}function ge(t){const r=t.relatedTarget;n.contains(r)||fe()}function Ee(t){const r=t.target,e=h.some(a=>a.el.contains(r));!n.contains(r)&&!e&&r!==s&&M()}function he(t){if(t.key==="Escape"){M();return}if(!w)return;const r=Array.from(y.querySelectorAll('[data-menu-item="1"]')),e=document.activeElement,a=r.indexOf(e);if(t.key==="ArrowDown")t.preventDefault(),(r[Math.min(a+1,r.length-1)]||r[0]).focus();else if(t.key==="ArrowUp")t.preventDefault(),(r[Math.max(a-1,0)]||r[r.length-1]).focus();else if(t.key==="Enter"&&e&&e.dataset&&e.dataset.menuItem==="1")e.click();else if(!$&&t.key==="ArrowRight"&&e&&e.dataset&&e.dataset.menuItem==="1"){const l=h.find(c=>c.parentEl===e);if(l){t.preventDefault(),l.open();const v=Array.from(l.listEl.querySelectorAll('[data-menu-item="1"]'))[0];v&&v.focus()}}else if(!$&&t.key==="ArrowLeft"&&e){const l=h.find(c=>c.el.contains(e));l&&(t.preventDefault(),l.close(),l.parentEl.focus())}}return T(y,O(u)),document.body.appendChild(n),$||(s.addEventListener("mouseenter",pe),s.addEventListener("mouseleave",me),s.addEventListener("focus",be,!0),s.addEventListener("blur",ge,!0)),n.addEventListener("mouseenter",ye),n.addEventListener("mouseleave",ve),{el:n,open:W,close:M,toggle:Q,destroy:B,show:W,hide:M,get isHover(){return K},ui:{$trigger:{onMouseEnter(t){s.addEventListener("mouseenter",t)},onMouseLeave(t){s.addEventListener("mouseleave",r=>{setTimeout(()=>{t(r)},100)})},onClick(t){s.addEventListener("click",t)},onFocus(t){s.addEventListener("focus",t,!0)},onBlur(t){s.addEventListener("blur",t,!0)}}},setMenus(t){x(),T(y,O(t)),w&&R()}}}const{computePosition:_e,offset:ke,flip:Se,shift:Ie,autoUpdate:Oe}=window.FloatingUIDOM;function He(p,E={}){let s=p,u=E;s&&s.$trigger&&(u=s,s=s.$trigger);const{content:S="",placement:d="bottom-start",closeOnClickOutside:H=!0,onClose:P=null,manual:D=!1,trigger:L="click",hoverOpenDelay:U=200,hoverCloseDelay:$=200,zIndex:se=1e3,className:j=""}=u,J=Number(se)||1e3,n=document.createElement("div");n.className=`weui-popover ${j}`,n.style.position="fixed",n.style.zIndex=String(J),n.style.display="none",n.style.minWidth="100px",n.style.background="var(--weui-dropdown-bg)",n.style.color="var(--weui-dropdown-fg)",n.style.borderRadius="8px",n.style.boxShadow="var(--weui-dropdown-shadow)",n.style.padding="12px",n.style.fontSize="14px",n.style.lineHeight="1.4",n.style.boxSizing="border-box";const y=document.createElement("div");y.className="weui-popover-content";let m=S;typeof S=="function"&&(m=S()),m instanceof Node?y.appendChild(m):y.innerHTML=String(m),n.appendChild(y),document.body.appendChild(n);let h=null,x=!1,q=null,z=null;function Z(){_e(s,n,{placement:d,strategy:"fixed",middleware:[ke(8),Se(),Ie({padding:8})]}).then(({x:_,y:K})=>{Object.assign(n.style,{left:`${_}px`,top:`${K}px`})})}function T(){q&&(clearTimeout(q),q=null),z&&(clearTimeout(z),z=null)}function N(){T(),!x&&(x=!0,n.style.display="block",Z(),h=Oe(s,n,Z),L==="click"&&H&&setTimeout(()=>{document.addEventListener("click",M,!0)},0))}function w(){T(),x&&(x=!1,n.style.display="none",h&&(h(),h=null),document.removeEventListener("click",M,!0),P&&P())}function R(){x?w():N()}function W(){w(),n.remove(),T(),D||(L==="click"?s.removeEventListener("click",Q):L==="hover"&&(s.removeEventListener("mouseenter",B),s.removeEventListener("mouseleave",I),n.removeEventListener("mouseenter",B),n.removeEventListener("mouseleave",I)))}function M(_){x&&(n.contains(_.target)||s.contains(_.target)||w())}function Q(_){R()}function B(){T(),!x&&(q=setTimeout(()=>{N()},U))}function I(){T(),x&&(z=setTimeout(()=>{w()},$))}return D||(L==="click"?s.addEventListener("click",Q):L==="hover"&&(s.addEventListener("mouseenter",B),s.addEventListener("mouseleave",I),n.addEventListener("mouseenter",B),n.addEventListener("mouseleave",I))),{open:N,close:w,toggle:R,destroy:W,el:n}}return{DropdownMenu:Ce,Menu:b,MenuItem:g,Popover:He}}));
