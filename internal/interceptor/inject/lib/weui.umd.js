(function(D,b){typeof exports=="object"&&typeof module<"u"?module.exports=b():typeof define=="function"&&define.amd?define(b):(D=typeof globalThis<"u"?globalThis:D||self,D.Weui=b())})(this,(function(){"use strict";function D(m){return Array.isArray(m)?m:m&&Array.isArray(m.children)?m.children:m&&Array.isArray(m.menus)?m.menus:[]}function b(m={}){const{children:g=[],menus:s=null,onMouseLeave:a=null,template:I=null}=m,c={children:Array.isArray(g)?g:Array.isArray(s)?s:[],isOpen:!1,isHover:!1,template:I||b._DEFAULT_TEMPLATE||null,show(){c.isOpen=!0,c.__ref&&c.__ref.open&&c.__ref.open()},hide(){c.isOpen=!1,c.__ref&&c.__ref.close&&c.__ref.close()},setChildren(N){c.children=D(N),c.__ref&&c.__ref.listEl&&(c.__ref.listEl.innerHTML=""),c.__ref&&typeof c.__ref.renderItemsTo=="function"&&c.__ref.listEl?c.__ref.renderItemsTo(c.__ref.listEl,c.children):typeof c.refresh=="function"&&c.refresh()},onMouseLeave:a,ui:{$submenu:null},__ref:null};return c}b._DEFAULT_TEMPLATE=null,b.setTemplate=function(g){b._DEFAULT_TEMPLATE=g},b.getTemplate=function(){return b._DEFAULT_TEMPLATE};let ue=null,ae=null;function v(m={}){const{label:g="",disabled:s=!1,onClick:a=null,onMouseEnter:I=null,onMouseLeave:c=null,children:N=null,submenu:W=null,menus:P=null,template:O=null,indicatorTemplate:A=null}=m;return{label:g,disabled:s,onClick:a,onMouseEnter:I,onMouseLeave:c,children:Array.isArray(N)?N:Array.isArray(P)?P:null,submenu:W||null,isHover:!1,ui:{},template:O??ue,indicatorTemplate:A??ae}}v.setTemplate=function(g){ue=g},v.getTemplate=function(){return ue},v.setIndicatorTemplate=function(g){ae=g},v.getIndicatorTemplate=function(){return ae};const{computePosition:pe,offset:me,flip:ye,shift:be,autoUpdate:ve,arrow:Me}=window.FloatingUIDOM;function ke(m,g={}){let s=m,a=g;s&&s.$trigger&&(a=s,s=s.$trigger);const{placement:I="bottom-start",closeOnClickOutside:c=!0,closeOnSelect:N=!1,hoverOpenDelay:W=80,hoverCloseDelay:P=120,showArrow:O=!1,onClose:A=null,manual:U=!0,zIndex:de=1e3}=a,G=Number(de)||1e3,J=a&&a.template!=null?a.template:typeof b.getTemplate=="function"?b.getTemplate():null;let r,h;J?(r=M(J,a)||document.createElement("div"),h=r.querySelector('[data-menu-list="1"]')||r.querySelector(".weui-dropdown-list"),h||(h=document.createElement("div"),h.className="weui-dropdown-list",r.appendChild(h)),r.style.position="fixed",r.style.zIndex=String(G),r.style.display="none"):(r=document.createElement("div"),r.className="weui-dropdown",r.style.position="fixed",r.style.zIndex=String(G),r.style.display="none",r.style.minWidth="160px",r.style.background="var(--weui-dropdown-bg)",r.style.borderRadius="12px",r.style.boxShadow="var(--weui-dropdown-shadow)",r.style.border="0",r.style.padding="8px 0",h=document.createElement("div"),h.className="weui-dropdown-list",r.appendChild(h));const n=document.createElement("div");n.className="weui-dropdown-arrow",n.style.position="absolute",n.style.width="10px",n.style.height="10px",n.style.background="var(--weui-dropdown-bg)",n.style.borderLeft="0",n.style.borderTop="0",n.style.transform="rotate(45deg)",n.style.pointerEvents="none",n.style.display=O?"block":"none",r.appendChild(n);const T=[];function q(){T.forEach(t=>{t.close(),t.el.remove()}),T.length=0}function w(){T.forEach(t=>t.close())}function R(t,l,e){if(typeof t=="function"){const d=t(l);if(d instanceof Node)return d;if(typeof d=="string"){const i=document.createElement("div");let f=d.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));const y=l&&l.indicatorTemplate!=null?l.indicatorTemplate:v&&typeof v.getIndicatorTemplate=="function"?v.getIndicatorTemplate():null;return y&&e&&/\{\{\s*indicator\s*\}\}/.test(f)&&(typeof y=="string"?f=f.replace(/\{\{\s*indicator\s*\}\}/g,y):f=f.replace(/\{\{\s*indicator\s*\}\}/g,"")),i.innerHTML=f,i.firstElementChild||i}return null}if(t instanceof Node)return t;if(typeof t=="string"){const d=document.createElement("div");let i=t.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));const f=l&&l.indicatorTemplate!=null?l.indicatorTemplate:v&&typeof v.getIndicatorTemplate=="function"?v.getIndicatorTemplate():null;return f&&e&&/\{\{\s*indicator\s*\}\}/.test(i)&&(typeof f=="string"?i=i.replace(/\{\{\s*indicator\s*\}\}/g,f):i=i.replace(/\{\{\s*indicator\s*\}\}/g,"")),d.innerHTML=i,d.firstElementChild||d}return null}function M(t,l){const e=()=>'<div class="weui-dropdown-list" data-menu-list="1"></div>';if(typeof t=="function"){const d=t(l);if(d instanceof Node)return d;if(typeof d=="string"){const i=document.createElement("div");let f=d.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));return f=f.replace(/\{\{\s*list\s*\}\}/g,e()),i.innerHTML=f,i.firstElementChild||i}return null}if(t instanceof Node)return t;if(typeof t=="string"){const d=document.createElement("div");let i=t.replace(/\{\{\s*label\s*\}\}/g,String(l.label??""));return i=i.replace(/\{\{\s*list\s*\}\}/g,e()),d.innerHTML=i,d.firstElementChild||d}return null}function L(t,l){t.innerHTML="",l.forEach((e,d)=>{const i=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:null;let f=Array.isArray(i)&&i.length>0;const y=!!(e&&e.template!=null);let o;y?o=R(e.template,e,f)||document.createElement("div"):(o=document.createElement("button"),o.type="button",o.className="weui-dropdown-item",o.textContent=e.label,o.style.display="block",o.style.width="100%",o.style.textAlign="left",o.style.padding="12px 16px",o.style.fontSize="15px",o.style.color="var(--weui-dropdown-fg)",o.style.background="transparent",o.style.border="0",o.style.cursor="pointer",o.style.outline="none"),o.dataset.index=String(d),o.dataset.menuItem="1",!y&&e.disabled&&(o.disabled=!0,o.style.opacity="0.5",o.style.cursor="not-allowed"),e.disabled?(o.setAttribute("aria-disabled","true"),y&&(o.tabIndex=-1)):y&&!(o instanceof HTMLButtonElement)&&!(o instanceof HTMLAnchorElement)&&(o.tabIndex=0,o.setAttribute("role","menuitem")),o.addEventListener("mouseenter",()=>{y||(o.style.background="var(--weui-dropdown-hover-bg)"),e.onMouseEnter&&e.onMouseEnter(),e&&(e.isHover=!0)}),o.addEventListener("mouseleave",S=>{y||(o.style.background="transparent"),setTimeout(()=>{e&&(e.isHover=!1),e.onMouseLeave&&e.onMouseLeave(S);const oe=e&&e.submenu&&e.submenu.ui&&e.submenu.ui.$submenu;oe&&S&&S.relatedTarget&&oe.contains(S.relatedTarget)?e.submenu.isHover=!0:e&&e.submenu&&(e.submenu.isHover=!1)},100)});let K=null;if(f){let fe=function(){le&&(clearTimeout(le),le=null),ie&&(clearTimeout(ie),ie=null)},Te=function(){const p=o.closest(".weui-dropdown")||o.closest(".custom-menu")||r,k=p&&parseFloat(window.getComputedStyle(p).paddingRight)||0;pe(o,u,{placement:"right-start",strategy:"fixed",middleware:[me(()=>8+k),ye(),be({padding:8})]}).then(({x:Ae,y:Ne})=>{Object.assign(u.style,{left:`${Ae}px`,top:`${Ne}px`})})},we=function(){if(re)return;const p=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:[];L(x,p),re=!0,u.style.display="block",Te(),_(),se=ve(o,u,Te)},Le=function(){re&&(re=!1,u.style.display="none",se&&(se(),se=null))},De=function(){fe(),le=setTimeout(()=>{we()},W)},xe=function(){fe(),ie=setTimeout(()=>{Le()},P)};if(y){const p=e&&e.indicatorTemplate!=null?e.indicatorTemplate:v&&typeof v.getIndicatorTemplate=="function"?v.getIndicatorTemplate():null;if(p){const k=R(p,e);k&&(k.classList.add("weui-dropdown-indicator"),typeof e.template=="string"&&/\{\{\s*indicator\s*\}\}/.test(e.template)||o.appendChild(k))}}else{const p=document.createElement("span");p.textContent="â€º",p.style.float="right",p.style.opacity="0.6",p.style.fontSize="14px",p.style.userSelect="none",o.appendChild(p)}const S=e.submenu&&e.submenu.template!=null?e.submenu.template:typeof b.getTemplate=="function"?b.getTemplate():null,oe=!!S;let u,x;oe?(u=M(S,e)||document.createElement("div"),x=u.querySelector('[data-menu-list="1"]')||u.querySelector(".weui-dropdown-list"),x||(x=document.createElement("div"),x.className="weui-dropdown-list",u.appendChild(x)),u.style.position="fixed",u.style.zIndex=String(G+1),u.style.display="none"):(u=document.createElement("div"),u.className="weui-dropdown",u.style.position="fixed",u.style.zIndex=String(G+1),u.style.display="none",u.style.minWidth="160px",u.style.background="var(--weui-dropdown-bg)",u.style.borderRadius="12px",u.style.boxShadow="var(--weui-dropdown-shadow)",u.style.border="0",u.style.padding="8px 0",x=document.createElement("div"),x.className="weui-dropdown-list",u.appendChild(x)),document.body.appendChild(u),L(x,i);let se=null,re=!1,le=null,ie=null;U?(u.addEventListener("mouseenter",()=>{e.submenu&&(e.submenu.isHover=!0)}),u.addEventListener("mouseleave",p=>{e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(p),e.submenu&&(e.submenu.isHover=!1)})):(o.addEventListener("mouseenter",()=>{De()}),o.addEventListener("mouseleave",p=>{const k=p.relatedTarget;u.contains(k)||xe()}),u.addEventListener("mouseenter",()=>{fe(),_(),e.submenu&&(e.submenu.isHover=!0)}),u.addEventListener("mouseleave",p=>{const k=p.relatedTarget;o.contains(k)||xe(),e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(p),e.submenu&&(e.submenu.isHover=!1)})),K={el:u,listEl:x,parentEl:o,open:we,close:Le,renderItemsTo:(p,k)=>L(p,k)},T.push(K),e.submenu&&(e.submenu.__ref=K,e.submenu.ui={$submenu:u},e.submenu.isOpen=!1,e.submenu.refresh=()=>{const p=Array.isArray(e.submenu.children)?e.submenu.children:[];L(x,p)},e.submenu.show=()=>{K.open(),e.submenu.isOpen=!0},e.submenu.hide=()=>{K.close(),e.submenu.isOpen=!1})}o.addEventListener("click",S=>{e.disabled||(f?U?e.onClick&&e.onClick(S):K&&K.open():(e.onClick&&e.onClick(S),N&&E()))}),t.appendChild(o)})}let H=null,C=!1;function $(){pe(s,r,{placement:I,strategy:"fixed",middleware:[me(8),ye(),be({padding:8}),O?Me({element:n}):void 0]}).then(({x:t,y:l,middlewareData:e,placement:d})=>{Object.assign(r.style,{left:`${t}px`,top:`${l}px`});const{x:i=0,y:f=0}=e.arrow||{},y={top:"bottom",right:"left",bottom:"top",left:"right"}[d.split("-")[0]];Object.assign(n.style,{left:i!=null?`${i}px`:"",top:f!=null?`${f}px`:"",right:"",bottom:""}),O&&(n.style[y]="-5px")})}function z(){C||(q(),L(h,D(a)),C=!0,r.style.display="block",$(),H=ve(s,r,$),c&&document.addEventListener("mousedown",he,!0),document.addEventListener("keydown",Ee,!0))}function E(){C&&(C=!1,r.style.display="none",w(),H&&(H(),H=null),document.removeEventListener("mousedown",he,!0),document.removeEventListener("keydown",Ee,!0),A&&A())}function X(){C?E():z()}function ce(){E(),r.remove(),s.removeEventListener("mouseenter",ee),s.removeEventListener("mouseleave",te),s.removeEventListener("focus",ne,!0),s.removeEventListener("blur",ge,!0),r.removeEventListener("mouseenter",Q),r.removeEventListener("mouseleave",V)}let B=null,Z=null,F=!1;function _(){B&&(clearTimeout(B),B=null),Z&&(clearTimeout(Z),Z=null)}function j(){_(),B=setTimeout(()=>{z()},W)}function Y(){_(),Z=setTimeout(()=>{E()},P)}function ee(){j()}function te(t){const l=t.relatedTarget,e=T.some(d=>d.el.contains(l));!r.contains(l)&&!e&&Y()}function Q(){F=!0,_(),a&&typeof a.onMouseEnter=="function"&&a.onMouseEnter(),a&&!Array.isArray(a.children)&&!Array.isArray(a.menus)&&(a.isHover=!0)}function V(t){F=!1,a&&typeof a.onMouseLeave=="function"&&a.onMouseLeave(t),a&&!Array.isArray(a.children)&&!Array.isArray(a.menus)&&(a.isHover=!1)}function ne(){j()}function ge(t){const l=t.relatedTarget;r.contains(l)||Y()}function he(t){const l=t.target,e=T.some(d=>d.el.contains(l));!r.contains(l)&&!e&&l!==s&&E()}function Ee(t){if(t.key==="Escape"){E();return}if(!C)return;const l=Array.from(h.querySelectorAll('[data-menu-item="1"]')),e=document.activeElement,d=l.indexOf(e);if(t.key==="ArrowDown")t.preventDefault(),(l[Math.min(d+1,l.length-1)]||l[0]).focus();else if(t.key==="ArrowUp")t.preventDefault(),(l[Math.max(d-1,0)]||l[l.length-1]).focus();else if(t.key==="Enter"&&e&&e.dataset&&e.dataset.menuItem==="1")e.click();else if(!U&&t.key==="ArrowRight"&&e&&e.dataset&&e.dataset.menuItem==="1"){const i=T.find(f=>f.parentEl===e);if(i){t.preventDefault(),i.open();const y=Array.from(i.listEl.querySelectorAll('[data-menu-item="1"]'))[0];y&&y.focus()}}else if(!U&&t.key==="ArrowLeft"&&e){const i=T.find(f=>f.el.contains(e));i&&(t.preventDefault(),i.close(),i.parentEl.focus())}}return L(h,D(a)),document.body.appendChild(r),U||(s.addEventListener("mouseenter",ee),s.addEventListener("mouseleave",te),s.addEventListener("focus",ne,!0),s.addEventListener("blur",ge,!0)),r.addEventListener("mouseenter",Q),r.addEventListener("mouseleave",V),{el:r,open:z,close:E,toggle:X,destroy:ce,show:z,hide:E,get isHover(){return F},ui:{$trigger:{onMouseEnter(t){s.addEventListener("mouseenter",t)},onMouseLeave(t){s.addEventListener("mouseleave",l=>{setTimeout(()=>{t(l)},100)})},onClick(t){s.addEventListener("click",t)},onFocus(t){s.addEventListener("focus",t,!0)},onBlur(t){s.addEventListener("blur",t,!0)}}},setMenus(t){q(),L(h,D(t)),C&&$()}}}const{computePosition:Ce,offset:_e,flip:Se,shift:Ie,autoUpdate:Oe,arrow:He}=window.FloatingUIDOM;function $e(m,g={}){let s=m,a=g;s&&s.$trigger&&(a=s,s=s.$trigger);const{content:I="",placement:c="bottom-start",closeOnClickOutside:N=!0,showArrow:W=!0,onClose:P=null,manual:O=!1,trigger:A="click",hoverOpenDelay:U=200,hoverCloseDelay:de=200,zIndex:G=1e3,theme:J="light",className:r=""}=a,h=Number(G)||1e3,n=document.createElement("div");n.className=`weui-popover ${r}`,n.style.position="fixed",n.style.zIndex=String(h),n.style.display="none",n.style.minWidth="100px",n.style.maxWidth="300px",n.style.background=J==="dark"?"#4c4c4c":"#ffffff",n.style.color=J==="dark"?"#ffffff":"#000000",n.style.borderRadius="8px",n.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.1)",n.style.padding="12px",n.style.fontSize="14px",n.style.lineHeight="1.4",n.style.boxSizing="border-box",J==="dark"?n.style.setProperty("--weui-popover-bg","#4c4c4c"):n.style.setProperty("--weui-popover-bg","#ffffff");const T=document.createElement("div");T.className="weui-popover-content";let q=I;typeof I=="function"&&(q=I()),q instanceof Node?T.appendChild(q):T.innerHTML=String(q),n.appendChild(T);const w=document.createElement("div");w.className="weui-popover-arrow",w.style.position="absolute",w.style.width="10px",w.style.height="10px",w.style.background="var(--weui-popover-bg)",w.style.transform="rotate(45deg)",w.style.pointerEvents="none",w.style.display=W?"block":"none",n.appendChild(w),document.body.appendChild(n);let R=null,M=!1,L=null,H=null;function C(){Ce(s,n,{placement:c,strategy:"fixed",middleware:[_e(8),Se(),Ie({padding:8}),W?He({element:w}):void 0]}).then(({x:j,y:Y,middlewareData:ee,placement:te})=>{Object.assign(n.style,{left:`${j}px`,top:`${Y}px`});const{x:Q=0,y:V=0}=ee.arrow||{},ne={top:"bottom",right:"left",bottom:"top",left:"right"}[te.split("-")[0]];Object.assign(w.style,{left:Q!=null?`${Q}px`:"",top:V!=null?`${V}px`:"",right:"",bottom:"",[ne]:"-5px"})})}function $(){L&&(clearTimeout(L),L=null),H&&(clearTimeout(H),H=null)}function z(){$(),!M&&(M=!0,n.style.display="block",C(),R=Oe(s,n,C),A==="click"&&N&&setTimeout(()=>{document.addEventListener("click",B,!0)},0))}function E(){$(),M&&(M=!1,n.style.display="none",R&&(R(),R=null),document.removeEventListener("click",B,!0),P&&P())}function X(){M?E():z()}function ce(){E(),n.remove(),$(),O||(A==="click"?s.removeEventListener("click",Z):A==="hover"&&(s.removeEventListener("mouseenter",F),s.removeEventListener("mouseleave",_),n.removeEventListener("mouseenter",F),n.removeEventListener("mouseleave",_)))}function B(j){M&&(n.contains(j.target)||s.contains(j.target)||E())}function Z(j){X()}function F(){$(),!M&&(L=setTimeout(()=>{z()},U))}function _(){$(),M&&(H=setTimeout(()=>{E()},de))}return O||(A==="click"?s.addEventListener("click",Z):A==="hover"&&(s.addEventListener("mouseenter",F),s.addEventListener("mouseleave",_),n.addEventListener("mouseenter",F),n.addEventListener("mouseleave",_))),{open:z,close:E,toggle:X,destroy:ce,el:n}}return{DropdownMenu:ke,Menu:b,MenuItem:v,Popover:$e}}));
