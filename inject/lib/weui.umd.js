(function(L,y){typeof exports=="object"&&typeof module<"u"?module.exports=y():typeof define=="function"&&define.amd?define(y):(L=typeof globalThis<"u"?globalThis:L||self,L.Weui=y())})(this,(function(){"use strict";function L(p){return Array.isArray(p)?p:p&&Array.isArray(p.children)?p.children:p&&Array.isArray(p.menus)?p.menus:[]}function y(p={}){const{children:g=[],menus:i=null,onMouseLeave:a=null,template:H=null}=p,c={children:Array.isArray(g)?g:Array.isArray(i)?i:[],isOpen:!1,isHover:!1,template:H||y._DEFAULT_TEMPLATE||null,show(){c.isOpen=!0,c.__ref&&c.__ref.open&&c.__ref.open()},hide(){c.isOpen=!1,c.__ref&&c.__ref.close&&c.__ref.close()},setChildren(k){c.children=L(k),c.__ref&&c.__ref.listEl&&(c.__ref.listEl.innerHTML=""),c.__ref&&typeof c.__ref.renderItemsTo=="function"&&c.__ref.listEl?c.__ref.renderItemsTo(c.__ref.listEl,c.children):typeof c.refresh=="function"&&c.refresh()},onMouseLeave:a,ui:{$submenu:null},__ref:null};return c}y._DEFAULT_TEMPLATE=null,y.setTemplate=function(g){y._DEFAULT_TEMPLATE=g},y.getTemplate=function(){return y._DEFAULT_TEMPLATE};let K=null,G=null;function b(p={}){const{label:g="",disabled:i=!1,onClick:a=null,onMouseEnter:H=null,onMouseLeave:c=null,children:k=null,submenu:P=null,menus:O=null,template:I=null,indicatorTemplate:D=null}=p;return{label:g,disabled:i,onClick:a,onMouseEnter:H,onMouseLeave:c,children:Array.isArray(k)?k:Array.isArray(O)?O:null,submenu:P||null,isHover:!1,ui:{},template:I??K,indicatorTemplate:D??G}}b.setTemplate=function(g){K=g},b.getTemplate=function(){return K},b.setIndicatorTemplate=function(g){G=g},b.getIndicatorTemplate=function(){return G};const{computePosition:X,offset:Y,flip:Z,shift:ee,autoUpdate:ne,arrow:Te}=window.FloatingUIDOM;function we(p,g={}){let i=p,a=g;i&&i.$trigger&&(a=i,i=i.$trigger);const{placement:H="bottom-start",closeOnClickOutside:c=!0,closeOnSelect:k=!1,hoverOpenDelay:P=80,hoverCloseDelay:O=120,showArrow:I=!1,onClose:D=null,manual:S=!0}=a,te=a&&a.template!=null?a.template:typeof y.getTemplate=="function"?y.getTemplate():null;let s,E;te?(s=le(te,a)||document.createElement("div"),E=s.querySelector('[data-menu-list="1"]')||s.querySelector(".weui-dropdown-list"),E||(E=document.createElement("div"),E.className="weui-dropdown-list",s.appendChild(E)),s.style.position="fixed",s.style.zIndex="1000",s.style.display="none"):(s=document.createElement("div"),s.className="weui-dropdown",s.style.position="fixed",s.style.zIndex="1000",s.style.display="none",s.style.minWidth="160px",s.style.background="var(--weui-dropdown-bg)",s.style.borderRadius="12px",s.style.boxShadow="var(--weui-dropdown-shadow)",s.style.border="0",s.style.padding="8px 0",E=document.createElement("div"),E.className="weui-dropdown-list",s.appendChild(E));const v=document.createElement("div");v.className="weui-dropdown-arrow",v.style.position="absolute",v.style.width="10px",v.style.height="10px",v.style.background="var(--weui-dropdown-bg)",v.style.borderLeft="0",v.style.borderTop="0",v.style.transform="rotate(45deg)",v.style.pointerEvents="none",v.style.display=I?"block":"none",s.appendChild(v);const A=[];function se(){A.forEach(n=>{n.close(),n.el.remove()}),A.length=0}function Le(){A.forEach(n=>n.close())}function re(n,r,e){if(typeof n=="function"){const u=n(r);if(u instanceof Node)return u;if(typeof u=="string"){const l=document.createElement("div");let d=u.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));const m=r&&r.indicatorTemplate!=null?r.indicatorTemplate:b&&typeof b.getIndicatorTemplate=="function"?b.getIndicatorTemplate():null;return m&&e&&/\{\{\s*indicator\s*\}\}/.test(d)&&(typeof m=="string"?d=d.replace(/\{\{\s*indicator\s*\}\}/g,m):d=d.replace(/\{\{\s*indicator\s*\}\}/g,"")),l.innerHTML=d,l.firstElementChild||l}return null}if(n instanceof Node)return n;if(typeof n=="string"){const u=document.createElement("div");let l=n.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));const d=r&&r.indicatorTemplate!=null?r.indicatorTemplate:b&&typeof b.getIndicatorTemplate=="function"?b.getIndicatorTemplate():null;return d&&e&&/\{\{\s*indicator\s*\}\}/.test(l)&&(typeof d=="string"?l=l.replace(/\{\{\s*indicator\s*\}\}/g,d):l=l.replace(/\{\{\s*indicator\s*\}\}/g,"")),u.innerHTML=l,u.firstElementChild||u}return null}function le(n,r){const e=()=>'<div class="weui-dropdown-list" data-menu-list="1"></div>';if(typeof n=="function"){const u=n(r);if(u instanceof Node)return u;if(typeof u=="string"){const l=document.createElement("div");let d=u.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));return d=d.replace(/\{\{\s*list\s*\}\}/g,e()),l.innerHTML=d,l.firstElementChild||l}return null}if(n instanceof Node)return n;if(typeof n=="string"){const u=document.createElement("div");let l=n.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));return l=l.replace(/\{\{\s*list\s*\}\}/g,e()),u.innerHTML=l,u.firstElementChild||u}return null}function M(n,r){n.innerHTML="",r.forEach((e,u)=>{const l=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:null;let d=Array.isArray(l)&&l.length>0;const m=!!(e&&e.template!=null);let t;m?t=re(e.template,e,d)||document.createElement("div"):(t=document.createElement("button"),t.type="button",t.className="weui-dropdown-item",t.textContent=e.label,t.style.display="block",t.style.width="100%",t.style.textAlign="left",t.style.padding="12px 16px",t.style.fontSize="15px",t.style.color="var(--weui-dropdown-fg)",t.style.background="transparent",t.style.border="0",t.style.cursor="pointer",t.style.outline="none"),t.dataset.index=String(u),t.dataset.menuItem="1",!m&&e.disabled&&(t.disabled=!0,t.style.opacity="0.5",t.style.cursor="not-allowed"),e.disabled?(t.setAttribute("aria-disabled","true"),m&&(t.tabIndex=-1)):m&&!(t instanceof HTMLButtonElement)&&!(t instanceof HTMLAnchorElement)&&(t.tabIndex=0,t.setAttribute("role","menuitem")),t.addEventListener("mouseenter",()=>{m||(t.style.background="var(--weui-dropdown-hover-bg)"),e.onMouseEnter&&e.onMouseEnter(),e&&(e.isHover=!0)}),t.addEventListener("mouseleave",w=>{m||(t.style.background="transparent"),setTimeout(()=>{e&&(e.isHover=!1),e.onMouseLeave&&e.onMouseLeave(w);const j=e&&e.submenu&&e.submenu.ui&&e.submenu.ui.$submenu;j&&w&&w.relatedTarget&&j.contains(w.relatedTarget)?e.submenu.isHover=!0:e&&e.submenu&&(e.submenu.isHover=!1)},100)});let C=null;if(d){let V=function(){W&&(clearTimeout(W),W=null),B&&(clearTimeout(B),B=null)},be=function(){const f=t.closest(".weui-dropdown")||t.closest(".custom-menu")||s,T=f&&parseFloat(window.getComputedStyle(f).paddingRight)||0;X(t,o,{placement:"right-start",strategy:"fixed",middleware:[Y(()=>8+T),Z(),ee({padding:8})]}).then(({x:he,y:_e})=>{Object.assign(o.style,{left:`${he}px`,top:`${_e}px`})})},ve=function(){if(R)return;const f=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:[];M(h,f),R=!0,o.style.display="block",be(),N(),q=ne(t,o,be)},ge=function(){R&&(R=!1,o.style.display="none",q&&(q(),q=null))},Me=function(){V(),W=setTimeout(()=>{ve()},P)},Ee=function(){V(),B=setTimeout(()=>{ge()},O)};if(m){const f=e&&e.indicatorTemplate!=null?e.indicatorTemplate:b&&typeof b.getIndicatorTemplate=="function"?b.getIndicatorTemplate():null;if(f){const T=re(f,e);T&&(T.classList.add("weui-dropdown-indicator"),typeof e.template=="string"&&/\{\{\s*indicator\s*\}\}/.test(e.template)||t.appendChild(T))}}else{const f=document.createElement("span");f.textContent="â€º",f.style.float="right",f.style.opacity="0.6",f.style.fontSize="14px",f.style.userSelect="none",t.appendChild(f)}const w=e.submenu&&e.submenu.template!=null?e.submenu.template:typeof y.getTemplate=="function"?y.getTemplate():null,j=!!w;let o,h;j?(o=le(w,e)||document.createElement("div"),h=o.querySelector('[data-menu-list="1"]')||o.querySelector(".weui-dropdown-list"),h||(h=document.createElement("div"),h.className="weui-dropdown-list",o.appendChild(h)),o.style.position="fixed",o.style.zIndex="1001",o.style.display="none"):(o=document.createElement("div"),o.className="weui-dropdown",o.style.position="fixed",o.style.zIndex="1001",o.style.display="none",o.style.minWidth="160px",o.style.background="var(--weui-dropdown-bg)",o.style.borderRadius="12px",o.style.boxShadow="var(--weui-dropdown-shadow)",o.style.border="0",o.style.padding="8px 0",h=document.createElement("div"),h.className="weui-dropdown-list",o.appendChild(h)),document.body.appendChild(o),M(h,l);let q=null,R=!1,W=null,B=null;S?(o.addEventListener("mouseenter",()=>{e.submenu&&(e.submenu.isHover=!0)}),o.addEventListener("mouseleave",f=>{e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(f),e.submenu&&(e.submenu.isHover=!1)})):(t.addEventListener("mouseenter",()=>{Me()}),t.addEventListener("mouseleave",f=>{const T=f.relatedTarget;o.contains(T)||Ee()}),o.addEventListener("mouseenter",()=>{V(),N(),e.submenu&&(e.submenu.isHover=!0)}),o.addEventListener("mouseleave",f=>{const T=f.relatedTarget;t.contains(T)||Ee(),e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(f),e.submenu&&(e.submenu.isHover=!1)})),C={el:o,listEl:h,parentEl:t,open:ve,close:ge,renderItemsTo:(f,T)=>M(f,T)},A.push(C),e.submenu&&(e.submenu.__ref=C,e.submenu.ui={$submenu:o},e.submenu.isOpen=!1,e.submenu.refresh=()=>{const f=Array.isArray(e.submenu.children)?e.submenu.children:[];M(h,f)},e.submenu.show=()=>{C.open(),e.submenu.isOpen=!0},e.submenu.hide=()=>{C.close(),e.submenu.isOpen=!1})}t.addEventListener("click",w=>{e.disabled||(d?S?e.onClick&&e.onClick(w):C&&C.open():(e.onClick&&e.onClick(w),k&&x()))}),n.appendChild(t)})}let $=null,_=!1;function J(){X(i,s,{placement:H,strategy:"fixed",middleware:[Y(8),Z(),ee({padding:8}),I?Te({element:v}):void 0]}).then(({x:n,y:r,middlewareData:e,placement:u})=>{Object.assign(s.style,{left:`${n}px`,top:`${r}px`});const{x:l=0,y:d=0}=e.arrow||{},m={top:"bottom",right:"left",bottom:"top",left:"right"}[u.split("-")[0]];Object.assign(v.style,{left:l!=null?`${l}px`:"",top:d!=null?`${d}px`:"",right:"",bottom:""}),I&&(v.style[m]="-5px")})}function F(){_||(se(),M(E,L(a)),_=!0,s.style.display="block",J(),$=ne(i,s,J),c&&document.addEventListener("mousedown",me,!0),document.addEventListener("keydown",ye,!0))}function x(){_&&(_=!1,s.style.display="none",Le(),$&&($(),$=null),document.removeEventListener("mousedown",me,!0),document.removeEventListener("keydown",ye,!0),D&&D())}function Ae(){_?x():F()}function xe(){x(),s.remove(),i.removeEventListener("mouseenter",ie),i.removeEventListener("mouseleave",ae),i.removeEventListener("focus",fe,!0),i.removeEventListener("blur",pe,!0),s.removeEventListener("mouseenter",de),s.removeEventListener("mouseleave",ce)}let U=null,z=null,Q=!1;function N(){U&&(clearTimeout(U),U=null),z&&(clearTimeout(z),z=null)}function oe(){N(),U=setTimeout(()=>{F()},P)}function ue(){N(),z=setTimeout(()=>{x()},O)}function ie(){oe()}function ae(n){const r=n.relatedTarget,e=A.some(u=>u.el.contains(r));!s.contains(r)&&!e&&ue()}function de(){console.log("onMenuEnter"),Q=!0,N(),a&&typeof a.onMouseEnter=="function"&&a.onMouseEnter(),a&&!Array.isArray(a.children)&&!Array.isArray(a.menus)&&(a.isHover=!0)}function ce(n){console.log("onMenuLeave"),Q=!1,a&&typeof a.onMouseLeave=="function"&&a.onMouseLeave(n),a&&!Array.isArray(a.children)&&!Array.isArray(a.menus)&&(a.isHover=!1)}function fe(){oe()}function pe(n){const r=n.relatedTarget;s.contains(r)||ue()}function me(n){const r=n.target,e=A.some(u=>u.el.contains(r));!s.contains(r)&&!e&&r!==i&&x()}function ye(n){if(n.key==="Escape"){x();return}if(!_)return;const r=Array.from(E.querySelectorAll('[data-menu-item="1"]')),e=document.activeElement,u=r.indexOf(e);if(n.key==="ArrowDown")n.preventDefault(),(r[Math.min(u+1,r.length-1)]||r[0]).focus();else if(n.key==="ArrowUp")n.preventDefault(),(r[Math.max(u-1,0)]||r[r.length-1]).focus();else if(n.key==="Enter"&&e&&e.dataset&&e.dataset.menuItem==="1")e.click();else if(!S&&n.key==="ArrowRight"&&e&&e.dataset&&e.dataset.menuItem==="1"){const l=A.find(d=>d.parentEl===e);if(l){n.preventDefault(),l.open();const m=Array.from(l.listEl.querySelectorAll('[data-menu-item="1"]'))[0];m&&m.focus()}}else if(!S&&n.key==="ArrowLeft"&&e){const l=A.find(d=>d.el.contains(e));l&&(n.preventDefault(),l.close(),l.parentEl.focus())}}return M(E,L(a)),document.body.appendChild(s),S||(i.addEventListener("mouseenter",ie),i.addEventListener("mouseleave",ae),i.addEventListener("focus",fe,!0),i.addEventListener("blur",pe,!0)),s.addEventListener("mouseenter",de),s.addEventListener("mouseleave",ce),{el:s,open:F,close:x,toggle:Ae,destroy:xe,show:F,hide:x,get isHover(){return Q},ui:{$trigger:{onMouseEnter(n){i.addEventListener("mouseenter",n)},onMouseLeave(n){i.addEventListener("mouseleave",r=>{setTimeout(()=>{n(r)},100)})},onClick(n){i.addEventListener("click",n)},onFocus(n){i.addEventListener("focus",n,!0)},onBlur(n){i.addEventListener("blur",n,!0)}}},setMenus(n){se(),M(E,L(n)),_&&J()}}}return{DropdownMenu:we,Menu:y,MenuItem:b}}));
