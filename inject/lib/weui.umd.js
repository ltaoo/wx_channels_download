(function(L,y){typeof exports=="object"&&typeof module<"u"?module.exports=y():typeof define=="function"&&define.amd?define(y):(L=typeof globalThis<"u"?globalThis:L||self,L.Weui=y())})(this,(function(){"use strict";function L(p){return Array.isArray(p)?p:p&&Array.isArray(p.children)?p.children:p&&Array.isArray(p.menus)?p.menus:[]}function y(p={}){const{children:g=[],menus:i=null,onMouseLeave:a=null,template:H=null}=p,c={children:Array.isArray(g)?g:Array.isArray(i)?i:[],isOpen:!1,isHover:!1,template:H||y._DEFAULT_TEMPLATE||null,show(){c.isOpen=!0,c.__ref&&c.__ref.open&&c.__ref.open()},hide(){c.isOpen=!1,c.__ref&&c.__ref.close&&c.__ref.close()},setChildren(I){c.children=L(I),c.__ref&&c.__ref.listEl&&(c.__ref.listEl.innerHTML=""),c.__ref&&typeof c.__ref.renderItemsTo=="function"&&c.__ref.listEl?c.__ref.renderItemsTo(c.__ref.listEl,c.children):typeof c.refresh=="function"&&c.refresh()},onMouseLeave:a,ui:{$submenu:null},__ref:null};return c}y._DEFAULT_TEMPLATE=null,y.setTemplate=function(g){y._DEFAULT_TEMPLATE=g},y.getTemplate=function(){return y._DEFAULT_TEMPLATE};let Z=null,G=null;function b(p={}){const{label:g="",disabled:i=!1,onClick:a=null,onMouseEnter:H=null,onMouseLeave:c=null,children:I=null,submenu:P=null,menus:O=null,template:S=null,indicatorTemplate:D=null}=p;return{label:g,disabled:i,onClick:a,onMouseEnter:H,onMouseLeave:c,children:Array.isArray(I)?I:Array.isArray(O)?O:null,submenu:P||null,isHover:!1,ui:{},template:S??Z,indicatorTemplate:D??G}}b.setTemplate=function(g){Z=g},b.getTemplate=function(){return Z},b.setIndicatorTemplate=function(g){G=g},b.getIndicatorTemplate=function(){return G};const{computePosition:X,offset:Y,flip:ee,shift:ne,autoUpdate:te,arrow:we}=window.FloatingUIDOM;function Le(p,g={}){let i=p,a=g;i&&i.$trigger&&(a=i,i=i.$trigger);const{placement:H="bottom-start",closeOnClickOutside:c=!0,closeOnSelect:I=!1,hoverOpenDelay:P=80,hoverCloseDelay:O=120,showArrow:S=!1,onClose:D=null,manual:k=!0,zIndex:Ae=1e3}=a,$=Number(Ae)||1e3,se=a&&a.template!=null?a.template:typeof y.getTemplate=="function"?y.getTemplate():null;let s,E;se?(s=oe(se,a)||document.createElement("div"),E=s.querySelector('[data-menu-list="1"]')||s.querySelector(".weui-dropdown-list"),E||(E=document.createElement("div"),E.className="weui-dropdown-list",s.appendChild(E)),s.style.position="fixed",s.style.zIndex=String($),s.style.display="none"):(s=document.createElement("div"),s.className="weui-dropdown",s.style.position="fixed",s.style.zIndex=String($),s.style.display="none",s.style.minWidth="160px",s.style.background="var(--weui-dropdown-bg)",s.style.borderRadius="12px",s.style.boxShadow="var(--weui-dropdown-shadow)",s.style.border="0",s.style.padding="8px 0",E=document.createElement("div"),E.className="weui-dropdown-list",s.appendChild(E));const v=document.createElement("div");v.className="weui-dropdown-arrow",v.style.position="absolute",v.style.width="10px",v.style.height="10px",v.style.background="var(--weui-dropdown-bg)",v.style.borderLeft="0",v.style.borderTop="0",v.style.transform="rotate(45deg)",v.style.pointerEvents="none",v.style.display=S?"block":"none",s.appendChild(v);const A=[];function re(){A.forEach(n=>{n.close(),n.el.remove()}),A.length=0}function xe(){A.forEach(n=>n.close())}function le(n,r,e){if(typeof n=="function"){const u=n(r);if(u instanceof Node)return u;if(typeof u=="string"){const l=document.createElement("div");let d=u.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));const m=r&&r.indicatorTemplate!=null?r.indicatorTemplate:b&&typeof b.getIndicatorTemplate=="function"?b.getIndicatorTemplate():null;return m&&e&&/\{\{\s*indicator\s*\}\}/.test(d)&&(typeof m=="string"?d=d.replace(/\{\{\s*indicator\s*\}\}/g,m):d=d.replace(/\{\{\s*indicator\s*\}\}/g,"")),l.innerHTML=d,l.firstElementChild||l}return null}if(n instanceof Node)return n;if(typeof n=="string"){const u=document.createElement("div");let l=n.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));const d=r&&r.indicatorTemplate!=null?r.indicatorTemplate:b&&typeof b.getIndicatorTemplate=="function"?b.getIndicatorTemplate():null;return d&&e&&/\{\{\s*indicator\s*\}\}/.test(l)&&(typeof d=="string"?l=l.replace(/\{\{\s*indicator\s*\}\}/g,d):l=l.replace(/\{\{\s*indicator\s*\}\}/g,"")),u.innerHTML=l,u.firstElementChild||u}return null}function oe(n,r){const e=()=>'<div class="weui-dropdown-list" data-menu-list="1"></div>';if(typeof n=="function"){const u=n(r);if(u instanceof Node)return u;if(typeof u=="string"){const l=document.createElement("div");let d=u.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));return d=d.replace(/\{\{\s*list\s*\}\}/g,e()),l.innerHTML=d,l.firstElementChild||l}return null}if(n instanceof Node)return n;if(typeof n=="string"){const u=document.createElement("div");let l=n.replace(/\{\{\s*label\s*\}\}/g,String(r.label??""));return l=l.replace(/\{\{\s*list\s*\}\}/g,e()),u.innerHTML=l,u.firstElementChild||u}return null}function M(n,r){n.innerHTML="",r.forEach((e,u)=>{const l=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:null;let d=Array.isArray(l)&&l.length>0;const m=!!(e&&e.template!=null);let t;m?t=le(e.template,e,d)||document.createElement("div"):(t=document.createElement("button"),t.type="button",t.className="weui-dropdown-item",t.textContent=e.label,t.style.display="block",t.style.width="100%",t.style.textAlign="left",t.style.padding="12px 16px",t.style.fontSize="15px",t.style.color="var(--weui-dropdown-fg)",t.style.background="transparent",t.style.border="0",t.style.cursor="pointer",t.style.outline="none"),t.dataset.index=String(u),t.dataset.menuItem="1",!m&&e.disabled&&(t.disabled=!0,t.style.opacity="0.5",t.style.cursor="not-allowed"),e.disabled?(t.setAttribute("aria-disabled","true"),m&&(t.tabIndex=-1)):m&&!(t instanceof HTMLButtonElement)&&!(t instanceof HTMLAnchorElement)&&(t.tabIndex=0,t.setAttribute("role","menuitem")),t.addEventListener("mouseenter",()=>{m||(t.style.background="var(--weui-dropdown-hover-bg)"),e.onMouseEnter&&e.onMouseEnter(),e&&(e.isHover=!0)}),t.addEventListener("mouseleave",w=>{m||(t.style.background="transparent"),setTimeout(()=>{e&&(e.isHover=!1),e.onMouseLeave&&e.onMouseLeave(w);const q=e&&e.submenu&&e.submenu.ui&&e.submenu.ui.$submenu;q&&w&&w.relatedTarget&&q.contains(w.relatedTarget)?e.submenu.isHover=!0:e&&e.submenu&&(e.submenu.isHover=!1)},100)});let C=null;if(d){let V=function(){B&&(clearTimeout(B),B=null),K&&(clearTimeout(K),K=null)},ve=function(){const f=t.closest(".weui-dropdown")||t.closest(".custom-menu")||s,T=f&&parseFloat(window.getComputedStyle(f).paddingRight)||0;X(t,o,{placement:"right-start",strategy:"fixed",middleware:[Y(()=>8+T),ee(),ne({padding:8})]}).then(({x:Te,y:Ie})=>{Object.assign(o.style,{left:`${Te}px`,top:`${Ie}px`})})},ge=function(){if(W)return;const f=e.submenu&&Array.isArray(e.submenu.children)?e.submenu.children:Array.isArray(e.children)?e.children:Array.isArray(e.menus)?e.menus:[];M(h,f),W=!0,o.style.display="block",ve(),N(),R=te(t,o,ve)},Ee=function(){W&&(W=!1,o.style.display="none",R&&(R(),R=null))},Ce=function(){V(),B=setTimeout(()=>{ge()},P)},he=function(){V(),K=setTimeout(()=>{Ee()},O)};if(m){const f=e&&e.indicatorTemplate!=null?e.indicatorTemplate:b&&typeof b.getIndicatorTemplate=="function"?b.getIndicatorTemplate():null;if(f){const T=le(f,e);T&&(T.classList.add("weui-dropdown-indicator"),typeof e.template=="string"&&/\{\{\s*indicator\s*\}\}/.test(e.template)||t.appendChild(T))}}else{const f=document.createElement("span");f.textContent="â€º",f.style.float="right",f.style.opacity="0.6",f.style.fontSize="14px",f.style.userSelect="none",t.appendChild(f)}const w=e.submenu&&e.submenu.template!=null?e.submenu.template:typeof y.getTemplate=="function"?y.getTemplate():null,q=!!w;let o,h;q?(o=oe(w,e)||document.createElement("div"),h=o.querySelector('[data-menu-list="1"]')||o.querySelector(".weui-dropdown-list"),h||(h=document.createElement("div"),h.className="weui-dropdown-list",o.appendChild(h)),o.style.position="fixed",o.style.zIndex=String($+1),o.style.display="none"):(o=document.createElement("div"),o.className="weui-dropdown",o.style.position="fixed",o.style.zIndex=String($+1),o.style.display="none",o.style.minWidth="160px",o.style.background="var(--weui-dropdown-bg)",o.style.borderRadius="12px",o.style.boxShadow="var(--weui-dropdown-shadow)",o.style.border="0",o.style.padding="8px 0",h=document.createElement("div"),h.className="weui-dropdown-list",o.appendChild(h)),document.body.appendChild(o),M(h,l);let R=null,W=!1,B=null,K=null;k?(o.addEventListener("mouseenter",()=>{e.submenu&&(e.submenu.isHover=!0)}),o.addEventListener("mouseleave",f=>{e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(f),e.submenu&&(e.submenu.isHover=!1)})):(t.addEventListener("mouseenter",()=>{Ce()}),t.addEventListener("mouseleave",f=>{const T=f.relatedTarget;o.contains(T)||he()}),o.addEventListener("mouseenter",()=>{V(),N(),e.submenu&&(e.submenu.isHover=!0)}),o.addEventListener("mouseleave",f=>{const T=f.relatedTarget;t.contains(T)||he(),e.submenu&&e.submenu.onMouseLeave&&e.submenu.onMouseLeave(f),e.submenu&&(e.submenu.isHover=!1)})),C={el:o,listEl:h,parentEl:t,open:ge,close:Ee,renderItemsTo:(f,T)=>M(f,T)},A.push(C),e.submenu&&(e.submenu.__ref=C,e.submenu.ui={$submenu:o},e.submenu.isOpen=!1,e.submenu.refresh=()=>{const f=Array.isArray(e.submenu.children)?e.submenu.children:[];M(h,f)},e.submenu.show=()=>{C.open(),e.submenu.isOpen=!0},e.submenu.hide=()=>{C.close(),e.submenu.isOpen=!1})}t.addEventListener("click",w=>{e.disabled||(d?k?e.onClick&&e.onClick(w):C&&C.open():(e.onClick&&e.onClick(w),I&&x()))}),n.appendChild(t)})}let F=null,_=!1;function J(){X(i,s,{placement:H,strategy:"fixed",middleware:[Y(8),ee(),ne({padding:8}),S?we({element:v}):void 0]}).then(({x:n,y:r,middlewareData:e,placement:u})=>{Object.assign(s.style,{left:`${n}px`,top:`${r}px`});const{x:l=0,y:d=0}=e.arrow||{},m={top:"bottom",right:"left",bottom:"top",left:"right"}[u.split("-")[0]];Object.assign(v.style,{left:l!=null?`${l}px`:"",top:d!=null?`${d}px`:"",right:"",bottom:""}),S&&(v.style[m]="-5px")})}function U(){_||(re(),M(E,L(a)),_=!0,s.style.display="block",J(),F=te(i,s,J),c&&document.addEventListener("mousedown",ye,!0),document.addEventListener("keydown",be,!0))}function x(){_&&(_=!1,s.style.display="none",xe(),F&&(F(),F=null),document.removeEventListener("mousedown",ye,!0),document.removeEventListener("keydown",be,!0),D&&D())}function Me(){_?x():U()}function _e(){x(),s.remove(),i.removeEventListener("mouseenter",ae),i.removeEventListener("mouseleave",de),i.removeEventListener("focus",pe,!0),i.removeEventListener("blur",me,!0),s.removeEventListener("mouseenter",ce),s.removeEventListener("mouseleave",fe)}let z=null,j=null,Q=!1;function N(){z&&(clearTimeout(z),z=null),j&&(clearTimeout(j),j=null)}function ue(){N(),z=setTimeout(()=>{U()},P)}function ie(){N(),j=setTimeout(()=>{x()},O)}function ae(){ue()}function de(n){const r=n.relatedTarget,e=A.some(u=>u.el.contains(r));!s.contains(r)&&!e&&ie()}function ce(){console.log("onMenuEnter"),Q=!0,N(),a&&typeof a.onMouseEnter=="function"&&a.onMouseEnter(),a&&!Array.isArray(a.children)&&!Array.isArray(a.menus)&&(a.isHover=!0)}function fe(n){console.log("onMenuLeave"),Q=!1,a&&typeof a.onMouseLeave=="function"&&a.onMouseLeave(n),a&&!Array.isArray(a.children)&&!Array.isArray(a.menus)&&(a.isHover=!1)}function pe(){ue()}function me(n){const r=n.relatedTarget;s.contains(r)||ie()}function ye(n){const r=n.target,e=A.some(u=>u.el.contains(r));!s.contains(r)&&!e&&r!==i&&x()}function be(n){if(n.key==="Escape"){x();return}if(!_)return;const r=Array.from(E.querySelectorAll('[data-menu-item="1"]')),e=document.activeElement,u=r.indexOf(e);if(n.key==="ArrowDown")n.preventDefault(),(r[Math.min(u+1,r.length-1)]||r[0]).focus();else if(n.key==="ArrowUp")n.preventDefault(),(r[Math.max(u-1,0)]||r[r.length-1]).focus();else if(n.key==="Enter"&&e&&e.dataset&&e.dataset.menuItem==="1")e.click();else if(!k&&n.key==="ArrowRight"&&e&&e.dataset&&e.dataset.menuItem==="1"){const l=A.find(d=>d.parentEl===e);if(l){n.preventDefault(),l.open();const m=Array.from(l.listEl.querySelectorAll('[data-menu-item="1"]'))[0];m&&m.focus()}}else if(!k&&n.key==="ArrowLeft"&&e){const l=A.find(d=>d.el.contains(e));l&&(n.preventDefault(),l.close(),l.parentEl.focus())}}return M(E,L(a)),document.body.appendChild(s),k||(i.addEventListener("mouseenter",ae),i.addEventListener("mouseleave",de),i.addEventListener("focus",pe,!0),i.addEventListener("blur",me,!0)),s.addEventListener("mouseenter",ce),s.addEventListener("mouseleave",fe),{el:s,open:U,close:x,toggle:Me,destroy:_e,show:U,hide:x,get isHover(){return Q},ui:{$trigger:{onMouseEnter(n){i.addEventListener("mouseenter",n)},onMouseLeave(n){i.addEventListener("mouseleave",r=>{setTimeout(()=>{n(r)},100)})},onClick(n){i.addEventListener("click",n)},onFocus(n){i.addEventListener("focus",n,!0)},onBlur(n){i.addEventListener("blur",n,!0)}}},setMenus(n){re(),M(E,L(n)),_&&J()}}}return{DropdownMenu:Le,Menu:y,MenuItem:b}}));
