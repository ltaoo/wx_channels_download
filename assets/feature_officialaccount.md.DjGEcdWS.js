import{_ as a}from"./chunks/official_account_rss.BCQ5QbpT.js";import{_ as i,c as e,o as t,ag as n}from"./chunks/framework.DjVFz-EU.js";const E=JSON.parse('{"title":"公众号","description":"","frontmatter":{"title":"公众号"},"headers":[],"relativePath":"feature/officialaccount.md","filePath":"feature/officialaccount.md","lastUpdated":1768038584000}'),p={name:"feature/officialaccount.md"};function l(h,s,o,d,k,c){return t(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="公众号" tabindex="-1">公众号 <a class="header-anchor" href="#公众号" aria-label="Permalink to &quot;公众号&quot;">​</a></h1><p>和视频号相同的注入方案，可以获取指定公众号的推送消息列表，并提供 <code>API</code> 调用</p><ul><li>获取指定公众号的推送消息列表</li><li>RSS</li></ul><p>需要打开某个公众号文章页面，并且不能关闭，否则调用接口时会提示 <code>{&quot;code&quot;:400,&quot;msg&quot;:&quot;请先初始化客户端 socket 连接&quot;}</code>。当出现该提示时，打开任意公众号文章页面即可，如果已经打开，刷新一下即可。</p><h2 id="获取指定公众号消息列表" tabindex="-1">获取指定公众号消息列表 <a class="header-anchor" href="#获取指定公众号消息列表" aria-label="Permalink to &quot;获取指定公众号消息列表&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:2022/api/mp/msg/list?biz=MzI2NDk5NzA0Mw==</span></span></code></pre></div><p>通过 <code>offset</code> 指定偏移量，可以获取到更多的消息记录</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:2022/api/mp/msg/list?biz=MzI2NDk5NzA0Mw==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&amp;offset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10</span></span></code></pre></div><h2 id="获取可请求的公众号列表" tabindex="-1">获取可请求的公众号列表 <a class="header-anchor" href="#获取可请求的公众号列表" aria-label="Permalink to &quot;获取可请求的公众号列表&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:2022/api/mp/list</span></span></code></pre></div><p>返回公众号昵称、头像和「授权凭证」。授权凭证用来请求「推送消息列表」，凭证有效期大概是半小时，需要定时刷新凭证</p><blockquote><p>凭证如果过期，不会从列表移除</p></blockquote><h2 id="公众号-rss" tabindex="-1">公众号 RSS <a class="header-anchor" href="#公众号-rss" aria-label="Permalink to &quot;公众号 RSS&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:2022/rss/mp?biz=MzI2NDk5NzA0Mw==</span></span></code></pre></div><p>同样可以传入 <code>offset</code> 获取到更多消息记录。</p><p>还提供 <code>proxy</code> 和 <code>content</code> 参数，分别用于代理公众号内容和默认获取公众号文章全文</p><h3 id="proxy" tabindex="-1">proxy <a class="header-anchor" href="#proxy" aria-label="Permalink to &quot;proxy&quot;">​</a></h3><p>如果阅读器提供获取全文能力，但是无法正确获取到公众号文章正文，可以指定 <code>proxy=1</code>，那么返回文章列表中，文章链接都会添加 <code>{ServiceAddr}/mp/proxy</code> 前缀，当打开文章时，将使用代理代为请求微信公众号返回正文内容</p><h3 id="content" tabindex="-1">content <a class="header-anchor" href="#content" aria-label="Permalink to &quot;content&quot;">​</a></h3><p>如果希望直接获取到正文，可以指定 <code>content=1</code>，那么请求 <code>RSS</code> 接口时，就会同时获取正文。但是缺点就是列表接口会比较慢（因为要依次请求到正文）</p><h2 id="远端服务模式" tabindex="-1">远端服务模式 <a class="header-anchor" href="#远端服务模式" aria-label="Permalink to &quot;远端服务模式&quot;">​</a></h2><p>本下载器依赖微信应用本体，导致无法在 <code>linux</code> 服务器上部署。所以额外增加「远端服务」模式，同时配合 本地+远端，可以在 <code>linux</code> 服务器上部署 <code>API</code> 和 <code>RSS</code> 服务</p><p><strong>仍需要 macOS 或 Windows 机器，用于同步「公众号授权凭证」到远端服务</strong></p><h3 id="部署说明" tabindex="-1">部署说明 <a class="header-anchor" href="#部署说明" aria-label="Permalink to &quot;部署说明&quot;">​</a></h3><p>下载构建包到 <code>linux</code> 服务器，修改配置文件</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># config.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2022</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">mp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  remoteServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rss.example.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  refreshToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  tokenFilepath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span></span></code></pre></div><p>其中 <code>refreshToken</code> 用于「本地」向「远端服务」提交「公众号授权凭证」时的校验，可以避免被无授权的人修改公众号授权凭证，导致服务不可用</p><p><code>tokenFilepath</code> 指定调用 <code>API</code> 或 <code>RSS</code> 时的授权凭证文件，可以留空。或者指定一个 <code>./token.txt</code>，那么会读取该文件，每行作为一个 <code>token</code>，调用接口时必须传入 <code>&amp;token=</code>，否则会拒绝访问。</p><p>使用 <code>chmod +x ./wx_video_download</code> 给二进制文件添加权限，然后运行命令 <code>./wx_video_download mp -d</code> 启动，该命令仅运行公众号相关的功能，且作为守护进程运行</p><p>运行成功之后，调用「获取可请求的公众号列表」会返回空列表。调用「获取指定公众号消息列表」会提示 <code>Please adding Credentials first</code></p><p>表示「远端服务」部署成功，接下来运行「本地」服务</p><p>在任意 <code>macOS</code> 或 <code>Windows</code> 机器上，下载对应平台构建包，修改配置文件</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># config.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">mp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  remoteServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rss.example.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  refreshToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  tokenFilepath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span></span></code></pre></div><p>内容和「远端服务」的配置文件保持相同。然后，通过命令 <code>./wx_video_download</code> 启动，<strong>打开任意公众号文章页面</strong>，会自动向「远端服务」提交该公众号的授权凭证</p><p>同时，在打开的公众号文章页面，账号名称旁会出现 RSS 图标，点击会复制 <code>RSS</code> 订阅链接</p><p><img src="`+a+'" alt="RSS按钮"></p><p>内容类似 <code>https://rss.example.com/rss/mp?biz=MzI2NDk5NzA0Mw==</code>，可以在浏览器打开该链接，验证服务是否正常</p><p>调用「获取可请求的公众号列表」，也可以看到刚刚打开的公众号信息</p><p>到此，公众号RSS 服务就可以正常使用了。本地 <code>macOS</code> 或 <code>Windows</code> 上的服务不要关闭，会定时获取在列表中的公众号，刷新凭证，保持「远端服务」的 <code>RSS</code> 服务一直可用</p>',39)])])}const u=i(p,[["render",l]]);export{E as __pageData,u as default};
